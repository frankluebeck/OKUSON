\documentclass[12pt,openany,a4paper]{book}

% $Id: manual.tex,v 1.49 2003/11/17 09:20:08 neunhoef Exp $

\parindent0.0em
\setlength{\parskip}{0.7ex plus 1.0ex}
\usepackage[latin1]{inputenc}
\usepackage{times}
\usepackage{calc}
\usepackage{a4wide}
\usepackage[colorlinks=true]{hyperref}

% avoid overfull hboxes because of long typewriter font strings
\tolerance=200
\setlength{\emergencystretch}{2em}

\newcommand{\OKUSON}{\textsf{OKUSON}}

\begin{document}
\title{\Huge \textbf {\OKUSON} Manual}
\author{Frank Lübeck\\Max Neunhöffer \\[2cm] Version \input{../VERSION}}
\maketitle
\tableofcontents

\chapter*{}
\section*{Copyright and License}

This software package may be freely distributed under the terms of the
GNU Public License, see chapter~\ref{ch:GPL} for the details of that
license.

\copyright\  (2003) Frank Lübeck and Max Neunhöffer

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Overview}

The {\OKUSON} package provides tools for offering exercise sheets via the
web. It grew out of programs written and used by the authors since several
semesters, when we had to organize exercise sessions accompanying beginners
courses in mathematics. Some of these courses had more than 1000 students.

The main purposes of this package are
\begin{itemize}
\item to enable the use of exercises which allow a mechanical check (multiple 
choice, yes-no questions, questions with easy to parse answers like numbers).
\item to allow giving \textbf{individual} exercise sheets to participants
by providing variants of questions and letting the system choose an
individual selection depending on the participant by a pseudo-random
process.
\item to automatize the management of the participants: registration for the
exercise course and exams, delivery of the exercise sheets via the web, 
collecting the  solutions of exercises as mentioned above via the web,
grading of these solutions, etc.
\end{itemize}

A more detailed account of our motivation and the description of some
experiences can be found in the article:

\begin{center}
\begin{minipage}{\textwidth-1in}
   Frank Lübeck und Max Neunhöffer,
\href{http://www.math.rwth-aachen.de:8001/~Frank.Luebeck/preprints/AufgServCARweb.pdf}{Übungsbetrieb über Webservice}, \href{http://www.fachgruppe-computeralgebra.de/CAR}{Computer Algebra Rundbrief} \textbf{31}, Oktober 2002
\end{minipage}
\end{center}

Our technical goal was to provide a system which is based on reliable and
easy to install software on the server side and which only assumes any
computer with internet access, any web browser and any program for printing 
PDF-files on the side of the participating students.

\section{Contents of the {\OKUSON} Package}

In the archive of this package you find:
\begin{itemize}
\item A collection of program modules for the scripting language
\href{http://www.python.org}{Python};
some are generic tools, for example for reading and writing certain
kinds of data files, handling of different types of template files,
a built-in web server, etc., and some specialized code for this
package.
\item 
A copy of the XML parser \texttt{RXP} by Richard Tobin at
the Language Technology Group, Edinburgh and its wrapper
\href{http://www.reportlab.com/xml/pyrxp.html}{pyRXP} for use with
Python.
\item
A complete set of sample web pages (in German) which are probably not
difficult to customize for other courses in other places. (The text on these
pages is the only language dependent part, such that an adjustment of this
package to other languages would be straightforward.)
\item 
A detailed documentation and user guide.
\item
Example exercises and exercise sheets.
\item 
Checking utilities for {\OKUSON} exercises and sheets.
\end{itemize}

\section{How to Use this Manual}

\begin{itemize}
\item Get started by reading and following chapter~\ref{ch:inst}, then you
already have a running server.
\item Look at some of the examples of exercises and browse
chapters~\ref{ch:introXML} and~\ref{ch:createExercisesSheets} to
learn how to create the exercises and sheets for the service. 
\item Chapter~\ref{ch:webpages} describes the customization of the web
pages, so read this if you need to adjust some details. 
\item Consider some of the remarks in~\ref{sec:insttips} to make your 
installation more
secure and robust. Then you are ready to publish the web site for your
course.
\item The next few chapters describe some administrative tasks and the
corresponding tools in {\OKUSON} when the course is running.
\item In the end there are some chapters on more techical aspects of the
package. These are mainly interesting if you want to add some functionality
to the package.
\end{itemize}

\section{Feedback}

We are interested  in all comments, suggestions,  extensions concerning this
package. Please, tell  us if you are  using the package for  some course. If
you create exercises and sheets in  {\OKUSON} format we would be grateful if
we could get a copy.

\section{Acknowledgements}

The authors of {\OKUSON} want to thank the following people and
organizations, because they have helped to make {\OKUSON} possible:

\begin{itemize}
\item Guido van Rossum, his coworkers, and the Python Software Foundation
for creating Python.
\item Donald E. Knuth for creating {\TeX} and lots of others who have 
helped to build the whole {\TeX/\LaTeX/Pdf\LaTeX} system.
\item The World Wide Web Consortium (W3C) for standardizing the web,
XML, CSS, and lots of other technologies.
\item All the people who have contributed to \texttt{ghostscript}.
\item All the people who have contributed to the \texttt{netpbm} tools.
\item Richard Tobin for implementing \textsf{RXP}, a validating XML parser.
\item Robin Becker and his colleagues at ReportLab Inc.~for providing
Python bindings for \textsf{RXP} in form of the Python extension module
\texttt{pyRXP}.
\item Thorsten Heck from Lehrstuhl A für Mathematik (RWTH Aachen) for
contributing statistic functions for the administrator menu.
\item Ingo Klöcker from Lehrstuhl A für Mathematik (RWTH Aachen) for
contributing patches and bugfixes.
\item Volker Dietrich, Thorsten Heck, Ingo Klöcker, and Axel Marschner for
using (and testing) {\OKUSON} even before the first official release and
for the valuable hints and suggestions during Wintersemester 2003/04.
\item All the others who have been forgotten in this list.
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Installation}\label{ch:inst}

\section{Quick Installation Overview}

The following describes briefly how to get the {\OKUSON} package installed on
your system.
Probably you want to use this section only to get an overview or as
a reminder for later installations when you already know the process.

All steps are explained in more detail in the next few sections. When you are
actually using {\OKUSON} for a course, you may also want to consider the tips
and tricks in~\ref{sec:insttips}.

\begin{enumerate}
\setlength{\parskip}{0mm}
\item Make sure you have Python version 2.2 or later installed.
\item Download \texttt{okuson-XXX.tar.gz} from:

\hspace*{5mm}\href{http://www.math.rwth-aachen.de/~OKUSON}%
{\texttt{http://www.math.rwth-aachen.de/\~{}OKUSON}}

\item Extract archive with: 

\hspace*{5mm}\texttt{gzip -dc okuson-XXX.tar.gz | tar xvf -}
\item Compile \texttt{pyRXP} with: 

\hspace*{5mm}\texttt{cd okuson/server ; ./makepyRXP}
\item Leave the \texttt{server} directory with: 

\hspace*{5mm}\texttt{cd ..}
\item Copy \texttt{Config.xml.sample} to \texttt{Config.xml} by doing

\hspace*{5mm}\texttt{cp Config.xml.sample Config.xml}

and edit it to adjust at least the \texttt{AdministratorPassword}
(use \texttt{cryptpasswd} to encrypt your password) and maybe some 
other obvious entries in the course section of this configuration file.

\item Copy the sample web pages to the document root: 

\hspace*{5mm}\verb!cp -r html.sample/* html!
\item Copy empty data files to places where they belong:

\hspace*{5mm}\texttt{cd data ; cp empty/* . ; cd ..}
\item Start server with: 

\hspace*{5mm}\texttt{start}
\item Test server by pointing your browser to 

\hspace*{5mm}\href{http://localhost:8000/index.html}%
{\texttt{http://localhost:8000/index.html}}

(substitute the \texttt{8000} if you have chosen another number in the
\texttt{Port} entry of the \texttt{Config.xml} file).
\item If things look alright, start customizing for your application:
have another look in the course section of the \texttt{Config.xml} file,
adjust details of the web pages (see~\ref{ch:webpages}), add information 
on tutoring groups (if applicable, see~\ref{sec:groups}), prepare the first
exercise sheets (see~\ref{ch:createExercisesSheets}). A more detailed
account of tasks occurring during a semester is given in 
chapter~\ref{ch:semsched}.
\item \textbf{Note}, that during the semester the {\OKUSON} server collects
and stores personal data of the participating students. So you \textbf{must}
be careful with the access to this data.
\end{enumerate}


\section{Prerequisites}

\subsubsection*{Personal}
To use the {\OKUSON} package as an administrator you need a working
knowledge of the following things:
\begin{itemize}
\item Editing ASCII files with a text editor.
\item Installing and starting programs under UNIX.
\item Writing HTML.
\item Writing {\LaTeX} code for exercises.
\end{itemize}
In addition you should be willing to learn a few facts about XML (see
chapter \ref{ch:introXML}) and XHTML 1.0. And, if you want to know in some
detail how things work or if you want to add some functionality to the
package, you need knowledge about the programming language Python.

\subsubsection*{Technical}
To run the {\OKUSON} server you need a UNIX system that is accessible from
the internet (so, you may need help from an administrator if you are behind
a firewall). The following software must be installed:

\begin{itemize}
\item \textbf{Python} version 2.2 or later (as of this writing, 2.3 is
the latest version released). You can test your Python installation by
just typing \texttt{python} in your shell. If it is installed, a short
banner with the version appears. You can leave the interpreter again
by typing Control-D.

If you are using Linux, there are probably packages available for
your distribution. However, you can also download the source from
\href{http://www.python.org}{\texttt{http://www.python.org}} 
and install it without having root
privileges.
\item A \textbf{C-compiler}. {\OKUSON} uses an XML parser coming as a
Python extension module, which is implemented in C. We include this
module in the {\OKUSON} distribution. However, it has to be built with your
version of Python being available. Note that your Python installation must be
fairly complete, in some Linux distributions you must install a package with
a name like python-dev or similar.
\item \textbf{\LaTeX}. The texts for questions are processed by {\TeX}, 
therefore one does need a full featured installation of {\TeX/\LaTeX} 
with PDF support. For example the teTeX-distribution provides everything
necessary.
\item \textbf{ghostscript}. Exercise texts are translated to images for use
on the web pages delivered by {\OKUSON}.
\item \textbf{netpbm}. A package for image conversions and manipulations,
the program \texttt{pnmtopng} leads to particularly small files for the
exercise text images. All Linux distributions probably have a
\texttt{netpbm} package, for other systems see
\href{http://netpbm.sourceforge.net}{http://netpbm.sourceforge.net}.
\item A \textbf{text editor}. Input for exercises, sheets and web pages
is generated with an ASCII text editor, which is also used to edit
the configuration.
\end{itemize}

If you want to use all features of {\OKUSON}, the following additional 
software packages are needed:
\begin{itemize}
\item A \textbf{web browser}. Not only the user access but also a great
deal of administrative tasks are done via the web interface, using
{\OKUSON}'s built-in web server. {\OKUSON} is tested with a wide range
of web browsers, including Mozilla and friends, Opera, Netscape, Lynx,
w3m, and even Internet Explorer.
\item A \textbf{PDF viewer} like \texttt{xpdf} or \texttt{acroread}. 
Previews of exercise sheets are generated as PDF files.
\item \texttt{xloadimage} (or some other viewer for images in PNG format) is 
needed to display test versions of exercises.
\item \texttt{less} is used to conveniently browse log files. 
\end{itemize}

The students participating in the courses organized with {\OKUSON} only 
need a web browser on any operating system and a PDF viewer to print out
their exercise sheets.

The following is \textbf{not} needed to run an {\OKUSON} server:
\begin{itemize}
\item Root privileges. A normal user can install and run an {\OKUSON}
server.
\item Web server. No web server apart from the one built into {\OKUSON} is
needed.
\item Data base. {\OKUSON} uses a simple and efficient way of storing
data in and reading from human legible files. No external data base
system is needed.
\end{itemize}

\subsubsection*{Needed Resources}

As an example, we give here some facts and numbers on our use of the
{\OKUSON} system for a big course during one semester (these are
estimates, based on experience with previous versions of the {\OKUSON}
programs):

\begin{description}
\item[Server Hardware:] We use a PC with two Pentium III (1GHz)
processors, 2 GB of memory, 40 GB IDE hard disc. However, any recent
PC with say at least 256 MB of memory and 100 MB of free disc space
and a reasonable connection to the internet could do the job as well.
The workload of the {\OKUSON} server, even for a course with many
participants, does not have a detectable impact on other work done on
our machine. This holds as well for CPU time as for memory usage.
\item[Number of participants:] 1200.
\item[Number of submissions of solutions:] more than 20000 (this leads to 
the by far
largest file in the \texttt{data} subdirectory, we expect a file of about 3
megabyte, where our sheets contain 20 interactive questions each.
Restarting the server with rereading all these data takes about 5 seconds.
\item[Memory needed by the server process to hold all data in memory:] a few
hundred kilobytes, hence neglectible.
\item[Number of page/file accesses:] a few million, even with (artificially 
caused) several thousand accesses per minute, the machine is still usable for
other tasks as well.
\item[Size of \texttt{log/server.log} file:] could grow to a few hundred
megabytes. If you are short of disc space, you can compress the files (with
\texttt{bzip2} they can be shrinked to 3--4\% of their original size), or
even throw away older entries.
\item[Number of PDF sheets produced on the fly:] in average each sheet is
requested between one and two times in  PDF format. That means that during
the semester up to 30000 PDF sheets are requested. The server machine needs
about 4 to 5 hours of CPU time for the corresponding calls to 
\texttt{pdflatex} --- distributed over the whole semester.
\end{description}

\section{Download}

You can download the {\OKUSON} distribution from the following web address:

\hspace*{1cm}\href{http://www.math.rwth-aachen.de/~OKUSON/}%
{\texttt{http://www.math.rwth-aachen.de/\~{}OKUSON}}

\noindent There you find this manual as a PDF file and a gzip'ed tar archive
containing the source code. You can extract the contents in any place in
the filesystem that is convenient by the following command:

\hspace*{1cm}\texttt{gzip -dc okuson-XXX.tar.gz | tar xvf -}

This command creates a directory \texttt{okuson} in the current working
directory, under which the full distribution resides. This directory
will be called ``the {\OKUSON} home directory'' or short ``\verb!$OKUSONHOME!''
in the sequel.

The next step is to compile the \texttt{pyRXP} extension module.


\section{Compilation}

As {\OKUSON} uses the Python extension module \texttt{pyRXP} which builts 
on the XML parser \texttt{RXP} written in C, some compilation is necessary.
Assuming that you have extracted the distribution as described in the 
previous section, you can compile \texttt{pyRXP} with the following
commands:

\hspace*{1cm}\texttt{cd okuson/server ; ./makepyRXP}

\noindent After the compilation you should find two files \texttt{pyRXP.so} and 
\texttt{pyRXPU.so} in this directory. Otherwise, please look for error 
messages in the output.

\noindent You can now leave the \texttt{server} directory again with

\hspace*{1cm}\texttt{cd ..}

\noindent The next step is to edit the configuration.


\section{Configuration}

In the  {\OKUSON} home  directory (the  directory \texttt{okuson}  which was
created during  extraction of  the archive)  there is a  file named
\texttt{Config.xml.sample}. It is a sample file for the file 
\texttt{Config.xml}, which is the  central  place  for configuration  of  the
{\OKUSON} server. In the beginning, you should copy the sample file to
the real one with the command:

\hspace*{1cm}\texttt{cp Config.xml.sample Config.xml}

This file is  an XML file (see  section~\ref{ch:introXML}
for a short introduction) that can be edited conveniently with an ASCII text
editor.  The entries of this file are explained in detail via  embedded  
comments.  

For a start and to get an impression adjust the first few entries in 
this file, say \texttt{CourseName}, \texttt{AdministratorPassword}, 
\texttt{Semester}, \texttt{Lecturer}, \texttt{Feedback} and maybe
\texttt{Port}. 

Note that if you have several courses running at the same time and want
to use the same machine for all those {\OKUSON} servers, you need a
different port for each instance of the server.

Note that the administrator password is stored encrypted, use the script
\texttt{cryptpasswd} in the {\OKUSON} home directory  to find an encryption 
of your password.

%%  For a start, you need to edit at least  two configuration options:
%%  
%%  \texttt{AdministratorPassword} and \texttt{Port}
%%  
%%  (and maybe some more of the obvious options in the beginning of the
%%  configuration file).
%%  
%%  The administrator password is used for authentication purposes during
%%  administration. It is only stored encrypted. You can use the little
%%  program \texttt{cryptpasswd} in the {\OKUSON} home directory to create
%%  an encrypted version of your password to put it into the configuration
%%  file.
%%  
%%  The port is the network port the {\OKUSON} server is listening to on the
%%  local host. The default value is $8000$, which should usually not be used
%%  by other programs. The {\OKUSON} server actually \textbf{is} a web server
%%  listening on this port. Check with your system administrator that the computer
%%  running the {\OKUSON} server can be contacted on the port you choose here.


\section{Getting started}

{\OKUSON} has a built-in web server and does nearly all its user
interaction via a  web interface.

The package contains a set of sample web pages (in German) and to get 
started just copy them into the subdirectory \texttt{html} (which is the
document root of the built-in web server in the default configuration). 
This is done with the following command, issued from the {\OKUSON} home
directory:

\hspace*{1cm}\verb!cp -r html.sample/* html!

The stuff that is copied with the abovementioned command consists of
\begin{itemize}
\item Style sheets with the extension \texttt{.css}.
\item Web page templates with the extension \texttt{.tpl}. These are
processed by the {\OKUSON} web server during startup and then delivered
to the web browser.
\item A few images with the extension \texttt{.png}.
\end{itemize}
Note that most  of the functionality of the {\OKUSON} server
is driven by these web pages. Their structure and content lead the user
through the menu system, organizes input and output from the server
and is therefore essential. 

In chapter~\ref{ch:webpages} we explain how to customize these web pages for
your course.

An {\OKUSON} server collects data about participants of your course,
submitted solutions of exercises, tutoring groups, etc. Such data are
stored in the subdirectory \texttt{data}. 
For a start you need empty versions of the data files. This can be achieved 
by the following commands:

\hspace*{1cm}\verb!cd data ; cp empty/* . ; cd ..!

This copies the empty versions of the data files to the
real versions. Please do not do this later when your server already
has accumulated data!

\section{Starting and Stopping the Server}

You can now try out the {\OKUSON} server by typing 

\hspace*{1cm}\texttt{start}

in the {\OKUSON} home directory. (Be patient, the first time you
call this some images of exercise texts are generated before the server can
start serving.) If everything went well, you
see some log messages, concluding with

\hspace*{1cm}[TIMESTAMP] \ \texttt{Ready to start service ...}

Otherwise, you have to read through the log messages and identify error 
messages, which start with ``\texttt{Error:}''. You also find the complete
log file under \texttt{log/server.log} in the {\OKUSON} home directory.

If the server was started up successfully, you can test it by
pointing your browser to the following URL:

\hspace*{1cm}\href{http://localhost:8000/index.html}%
{\texttt{http://localhost:8000/index.html}}

where the main menu for students should appear. Note that the
``\texttt{:8000}'' in this URL tells the browser to contact the
{\OKUSON} server on port $8000$. Therefore this of course has to be
changed according to the network port you chose during configuration.

If you want to stop the server, you can issue the command

\hspace*{1cm}\texttt{stop}

in the {\OKUSON} home directory.
The server finishes the ongoing requests and then terminates showing a few 
log messages.

There is also a script 

\hspace*{1cm}\texttt{restart}

that stops the server and restarts it. In general, whenever you change
something in the servers setup (say, you add or change exercises or sheets,
add some data in the \texttt{data} directory, change some web page, \ldots)
you must restart the server. The advantage of this approach is that you can
play around with your changes before they are published to the outside world
by the server (and the server is more efficient, because it caches and
preparses everything it needs during startup).

\section{Tips and Tricks: Security, Backup, etc.}\label{sec:insttips}

In this section we mention some details of our own use of this package.
Maybe you find some of these remarks useful.

\subsubsection*{Setting the Locale}

We set the locale for the server correctly, such that date and time
strings are displayed according to the local standards. This is
achieved by setting the \verb+LC_ALL+ environment
variable to appropriately (for example \verb+de_DE+ for German, see the
\texttt{man} page of \texttt{locale} on your system, usually ``\texttt{locale
-a}'' lists the available settings).
 
\subsubsection*{Using a Pseudo User}

We always create a pseudo user as administrator of the package. This makes
it easy to share the administration between several people without fiddling
around with strange file access settings in private directories.

We close completely (\verb+chmod 700 ~+) the access to the pseudo users
home directory. \textbf{Note} that during the semester the {\OKUSON}
server collects and stores personal data of the participating students.
So, you \textbf{must} be careful with the access to this data.

\subsubsection*{Securing the Administrator Access}
\label{AdministrationAccessList}
We always choose a very restricted setting for the machines from which 
administrator access to an {\OKUSON} server is allowed, see the entry
\texttt{AdministrationAccessList} in the configuration file
\texttt{Config.xml}. 

Note that the administrator of an {\OKUSON} server is quite powerful:
in all web forms of the system where a password (of a participant, a tutor or
the administrator) is required, the
administrator password is considered valid \emph{provided} the request is
coming from a machine with administrator access. As administrator you can
see sheets which are not yet open, submit solutions to closed sheets, change
a user password, get any user's sheets and results and use the 
\texttt{/adminmenu.html} functions.

\subsubsection*{Make Sure Your Server Uses the Correct Time}

Since an {\OKUSON} server is very strict about accepting submitted solutions
as long as a sheet is open and showing the grading after a sheet is closed,
it is very important that the server uses the correct local time. Otherwise
expect unpleasant discussions with your students, some of them tend to hand
in their solutions in the last minute.

We use the network time protocol (NTP) service on our machines, using the
\texttt{ntpdate} program.

\subsubsection*{Backup}

Since the data collected by an {\OKUSON} server can be relevant for grades
it is important to have a good backup system for them.  

We use a machine different from the one running the {\OKUSON} server for
this. It has Paul Vixie's version of the \texttt{cron} program installed and 
we define (as the {\OKUSON} pseudo user) \texttt{crontab} entries like:

\begin{verbatim}
   MAILTO=""
   */5 * * * * ~/okusonsync 
   10 * * * * ~/okusonarchive
\end{verbatim}

Here, the scripts \texttt{okusonsync} and \texttt{okusonarchive} are in the
pseudo users home directory and look as in the following examples (using the
\texttt{rsync}, \texttt{tar}, \texttt{gzip} and \texttt{ssh} programs,
assuming that the pseudo user can login from the backup machine to the
server machine with ssh without password).

\begin{verbatim}
   #!/bin/sh
   ##  okusonsync    syncronizes an OKUSON inst. using rsync

   BACKUPDIR="..."
   ORIGSERVER="..."
   ORIGDIR="..."  # no final '/'

   cd $BACKUPDIR
   rsync -a --delete -e ssh $ORIGSERVER:$ORIGDIR .
\end{verbatim}

and

\begin{verbatim}
   #!/bin/sh
   ##  okusonarchive     packs whole backup into an archive

   BACKUPDIR="..."
   DIRNAME="..."

   cd $BACKUPDIR
   fname=`date +"BACKUP-%Y-%m-%d_%H_%M_%S.tgz"`
   tar czf $fname $DIRNAME
\end{verbatim}

In this setup, every five minutes all files of an {\OKUSON} installation 
are synchronised to the backup machine (this takes a split second after the 
first time). And once an hour all files are packed and compressed, archiving 
the precise status of the whole system.

(Furthermore we have a daily backup of all data on all machines in our 
institute.)

These precautions allow a quick recovery of most or all data after a
possible crash or data corruption of the original server.

\subsubsection*{Restarting Server after Reboot}

Usually, our server machines are never rebooted. But in case that happens
for some reason (e.g., a power failure) it is desirable that the downtime of
the {\OKUSON} service is as short as possible. For this we use an entry
in the \texttt{crontab} of the pseudo user on the server machine like

\begin{verbatim}
   @reboot  /MYOKUSONDIR/server/Server.py &
\end{verbatim}

where \texttt{MYOKUSONDIR} has to be replaced by the full absolute path to the
{\OKUSON} home directory.

\subsubsection*{Alias for Server Machine}

We create an alias for the machine running the {\OKUSON} server. This means
putting an extra entry with an additional name in the domain name server (DNS).
One usually needs root privileges to do this.

The advantage of the alias name is that it allows a quick move of the
whole service to another machine, in case the server crashes for some
reason.

\subsubsection*{\emph{Paperless} Courses}

With the exception of exam exercise sheets we do not print any paper for
courses with {\OKUSON} exercises. Registration, exercise sheets, 
announcements, exam results, final grades are \emph{only} available via the
{\OKUSON} server web interface. Our experience was that  no students complain
about this approach.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Schedule of Events for One Course}\label{ch:semsched}

In this chapter we go through the complete schedule for one course as
we imagine it and describe the actions one has to perform during the various
stages with respect to {\OKUSON}. Of course, you will have to adapt this
to your specific situation. We hope however, that this chapter also gives
a good overview over and a reference for the facilities of the {\OKUSON}
system, because it also contains a lot of references to various sections
of this manual.

We proceed chronologically and divide roughly into the following stages:
before the semester, at the begin of the semester, during the semester
and after the semester.

\section{Before the Semester}

\begin{itemize}
\item \textbf{Installing {\OKUSON}.} See chapter \ref{ch:inst}. Here one
typically adjusts the configuration options for the course. After this
step, the pages are ready for registration. One can already create the
pages with bibliography and general information about the course.
\item \textbf{Creating exercises.} It can be reasonable to prepare some
exercises already in this early stage. One should not underestimate the
time that is needed to invent decent multiple choice exercises and enough
variants. If no exercises are available from earlier courses we calculate
one day per week for two people to create the exercises for one sheet.

It also cannot hurt to get used to the way exercises and sheets are entered
into {\OKUSON}.

It has proven sensible to have a sheet number $0$ which does not count in
the end for the grade and which is available already at registration time,
such that the participants can practice to use the system before the 
actual exercises begin.
\end{itemize}

\section{At the Beginning of the Semester}

\begin{itemize}
\item \textbf{Registration of participants.} Once you tell the students
the URL of the {\OKUSON} server, they can register. Obviously, you want
to give them a few days for this purpose, before you distribute the
registered participants into small tutoring groups.
\item \textbf{Distribution of participants into tutoring groups.} See
chapter \ref{ch:managepeople}. 
\item \textbf{Setup of group information.} About at the same time than
the previous step you want to edit \texttt{data/groupinfo.txt} to set
up the information about your small tutoring groups. You can enter the
names of the tutors and the time and place of their sessions. Also every
tutor gets a password at this stage.
\item \textbf{Publishing of distribution into tutoring groups.} From the
moment you enter the distribution data into \texttt{data/groups.txt}
and restart the {\OKUSON} server, the distribution is automatically
published via the web pages. Note that the information you entered in
the previous step is shown on the automatically generated pages.
\end{itemize}

\section{During the Semester}

\begin{itemize}
\item \textbf{Distribute late-comers into groups.} Especially in big
courses with hundreds of participants, there always will be some sleepers
who only register late. These people automatically appear in group number $0$.
One has to distribute them by hand into tutoring groups by appending lines
to the file \texttt{data/groups.txt}.
\item \textbf{Create new exercise sheets.} Of course, you will create
further exercise sheets during the semester. Note that you can use the
attributes \texttt{openfrom} and \texttt{opento} to prepare the sheets
beforehand and let them appear automatically at a given time on the web
pages and let them be closed at another time. 
\item \textbf{Let participants query their results.} The participants will
query their results on a regular basis. Please note that there is the 
possibility to put up individual messages on the result pages via the
administrator menu (see section \ref{sendmess}) and to delete them
later.
\item \textbf{Tutors enter homework results.} There is a page especially
for the tutors to type in the results of the participants in their 
tutoring group, such that they appear on the result page. See section
\ref{sec:tutpage}.
\item \textbf{Exams during the course.} Especially for beginner's courses
it seems to be a good practice to organize a written exam at some stage
during the semester. The {\OKUSON} server can help you to organize this
by handling the registration of participants for such exams and by
producing the messages for the exams on the result page automatically,
once the result of the exam is imported into the server (see
\ref{ch:ExamOrga}).
\end{itemize}

\section{After the Semester}

\begin{itemize}
\item \textbf{Exam at the end of the semester.} The {\OKUSON} server can
help to organize the registration of participants of exams at the end of the
semester, see \ref{ch:ExamOrga}.
\item \textbf{Automatic grading.} At this stage one can activate the 
automatic grading function to produce output for the result pages of
the participants, for example stating whether they get a certificate 
about successful participation in the course or not. Note that to use
this one has to learn a little bit of Python programming to customize
the automatic grading function to your needs. One also has to learn
a little bit about the internal data structures of {\OKUSON}, see
chapter \ref{ch:intdata}. You can also choose not to use this feature,
see the next step.
\item \textbf{Export of results for further processing.} Now that all
data about results is collected one can export these via the administrator
menu (see \ref{sec:expresults}). The idea of this step is to be able to
do statistical evaluations on this data. However, it is also possible to
use external tools or scripts on this exported data for example to decide
about grading by your own criteria. You can then import the result of these
external tools in form of private messages to participants via the
file \texttt{data/messages.txt} (see \ref{sec:messages.txt}).
\item \textbf{Producing certificates.} One can use the export of results
to produce certificates of successful participation.
\end{itemize}

\section{At all Times}

\begin{itemize}
\item You can at all times use the {\OKUSON} system to publish current
information about the course. Our experience shows that usually no other
means of publishing such information is needed any more.
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Short Introduction to XML}\label{ch:introXML}

XML is a standard by the W3C consortium
(\href{http://www.w3c.org}{\texttt{http://www.w3c.org}}) that allows
to define \emph{markup languages} for text documents and data such
that documents using such a language can be checked and processed
systematically with generic tools.

The {\OKUSON} package uses XML in several places:
\begin{itemize}
\item its configuration file \texttt{Config.xml} 
\item the files specifying exercise sheets (\texttt{xxx.bla})
\item the files containing the interactive exercises (\texttt{yyy.auf}) -
but the exercise texts are written in {\LaTeX}, a much more complicated
markup language
\item the delivered web pages are written with XHTML markup and the
templates for these pages are written with an XML markup  
\end{itemize}

The markup languages in each of these cases are different, but they are
almost self explaining and we provide sample files for all of them. 

In this chapter we give a basic introduction to the XML concept. This
knowledge may be useful to avoid syntax errors and to understand the messages 
of programs parsing an XML file containing errors and to correct such errors.

\section{An Example XML Document}\label{sec:exampleXML}
\label{sec:XMLbasics}

Here is a complete XML document. Below we give a short glossary  and explain
the main concepts of the markup.

\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>

<!DOCTYPE MainElt SYSTEM "nowhere.dtd">

<!-- This is a comment.          -->

<MainElt>

<A xattr="val of xattr">abc<B yattr='contains " quotes'></B></A> 

<EmptyElt />

<Long><![CDATA[
Protected <A> <B> XXX </A> </B>
]]></Long>

<Short>With &lt; entities &gt; and ampersand &amp; </Short>

</MainElt>

\end{verbatim}

An XML document usually starts with some meta-information.

The first line \texttt{<?xml \ldots} just tells that this is a document with
an XML defined markup.

The \texttt{<!DOCTYPE MainElt SYSTEM "nowhere.dtd">} line specifies the
language to which the markup belongs by pointing to the file name of a so 
called \emph{document type definition} (DTD). It also tells that the actual
content of the document is enclosed by \texttt{<MainElt \ldots>} and
\texttt{</MainElt>}.

The actual content of an XML document is structured by so called
\emph{elements}.  They
basically have the form \texttt{<A>something</A>}. Here \texttt{<A>} is called 
the \emph{begin tag} and \texttt{</A>} the \emph{end tag} of the element and 
\texttt{something} is the \emph{content} of the element.

The \emph{name} of an element, here \texttt{A}, is case sensitive, that is
\texttt{<A></A>} and \texttt{<a></a>} are different elements. 

There always must be a begin and end tag. A begin tag can contain further
information as in \texttt{<A xattr="val of xattr">} above. 
This extra information is called an \emph{attribute}, where
\texttt{xattr} is the \emph{name} of the attribute and ``\texttt{val of
xattr}'' is the \emph{value} of the attribute. An attribute must always
have a value and the specification of the value must be enclosed either
in double quotes (\texttt{"}) or in single quotes (\texttt{'}). The
enclosing quotes are not allowed within the value.

Contents of elements can themselves contain strings and/or other elements. But
elements must always be properly nested, as in the line 
\texttt{<A xattr=\ldots} above, for example \texttt{<A> <B> XXX </A> </B>}
is \emph{not allowed}.

Anywhere before or after all elements or in the content of an element there
can be a \emph{comment}. This is specified by enclosing it in
\texttt{<!--} and \texttt{-->}, the only character sequence not allowed in a
comment is \texttt{--}. A comment is \emph{not} part of the content of an
element. 

There can be elements whose content is always empty and which can be written
with a combined begin and end tag as in \texttt{<EmptyElt />}, these are
called \emph{empty elements}.

Sometimes the content of an element is a string which looks like containing XML 
markup. There are two possibilities to avoid an interpretation as markup.

The first is demonstrated in the \texttt{Long} element above, its content is
enclosed in \texttt{<![CDATA[} and \texttt{]]>}. Everything between these
markers is considered as content as it is. The only string not allowed
within such a CDATA section is \texttt{]]>}. (Note that the line
\texttt{Protected\ldots} is just element content and that there is no syntax
error.)

The other possibility are so called \emph{entities}. They are demonstrated
in the \texttt{Short} element of our example. They start with an ampersand
\texttt{\&} and close with a semicolon \texttt{;}. Entities are placeholders
for which a substitution text is somewhere defined. For example, the given
entities \texttt{\&lt;}, \texttt{\&gt;} and \texttt{\&amp;} specify the special
characters \texttt{<>\&} used for XML markup.

A document type definition (DTD) defines a markup language in the sense that
it says which elements are allowed in a document, which attributes are
allowed for each element and how elements can or must be nested. We don't
explain this in more detail here. The {\OKUSON} package has a directory
\texttt{dtd} containing the definitions of the markup used in this package.

\subsubsection*{Summary}
XML documents contain elements which must be empty or have begin and end
tag and which must be properly nested. Element names are case sensitive.
Elements can have attributes which
must have a value and the value must be enclosed in double or single quotes.
There are CDATA sections and entities for specifying content containing the
special characters used for XML markup.

\subsubsection*{Reference}
A detailed specification of the XML standard with useful annotations
is given in\\
\mbox{}\hspace{1in}\texttt{http://www.xml.com/axml/axml.html}.

\section{Parsing and Validating XML Documents}\label{sec:valXML}

The main advantage of using  XML for new document formats (like the exercise
sheets and exercises in \OKUSON) is that one can use standard tools to read
in and process the content of such documents. Programs which read  XML
documents  and translate it to some internal data structure are called
\emph{XML-parser}. 

XML documents that follow the formal rules explained 
in~\ref{sec:XMLbasics} 
are called \emph{well-formed XML documents}. This means, that they can
be parsed successfully, however, this does not imply
that they make any sense. 

As mentioned above the \texttt{DOCTYPE} entry of an XML file can point to a
document type definition. This defines element  names and gives restrictions
how elements can or must be nested, gives some information on the type of
content of certain elements, and it  defines for each element which
attributes are allowed and maybe some restriction on their values.

An XML  document which is  consistent with  the definitions in  its document
type is called  a \emph{valid XML document}. Some XML  parsers, like the one
we use  in the {\OKUSON}  programs, can check if  an XML document  is valid.
Such a parser is called a \emph{validating parser}. It is useful 
for the user who wants to check if a newly created document has the correct XML
structure, and it is useful for the programmer as a general tool for checking
the formal correctness of XML input.

As administrative user  of {\OKUSON} you can come across  the parsing of XML
files when you use the testscripts for exercise and exercise sheet documents
(see~\ref{ssec:checkexercise} and~\ref{ssec:checksheet}) and during startup
of the {\OKUSON} server when the template files for the web pages are
cached.

\subsubsection*{Validating and Checking Well Formedness}

In the {\OKUSON} home directory, there is a script \texttt{xmlvalidate}
which can be used to validate XML documents. (With \texttt{-w} argument it
is only checked if a document is well-formed.) In case of an error, a
sensible message for removing the problem is printed.

\chapter{Creating Exercises and Sheets}\label{ch:createExercisesSheets}

The {\OKUSON} package delivers exercises via the web. There are two types of
exercises, \emph{text  exercises} for which written  solutions are necessary
and \emph{interactive  exercises} whose  solutions are  submitted via  a web
interface  and  which are  automatically  graded  by the  {\OKUSON}  server.
The  interactive exercises  depend on  the  participant, they  consist of  a
(pseudo-)random  ordering and  choice of  variants of  some questions.  Such
exercises  cannot be  specified in  a  single static  \LaTeX-file, but  some
additional information is needed.

While the actual exercise texts must be written in \LaTeX, the additional
structure is added via some simple XML markup, see~\ref{ch:introXML}.
We provide for both types of documents templates which you can just copy and
fill in. Although these are almost self explaining we describe the details in
this chapter.

\section{Generalities on the Exercise and Sheet Files}

The directories containing exercises and sheets for an {\OKUSON} server must
be given  in the  configuration  file \texttt{\$OKUSONHOME/Config.xml},
see the \texttt{<ExerciseDirectories>} and \texttt{<SheetDirectories>}
elements. Each directory is given as a \texttt{DIR} element whose content
has the form \texttt{path/to/dir} or \texttt{path/to/dir|prefix}, the prefix
is used to distinguish exercises with the same name from different
directories, see~\ref{sec:Sheets}.

The default directories are \texttt{\$OKUSONHOME/exercises} and
\texttt{\$OKUSONHOME/sheets}, but you can change these and also use 
several directories for each or merge them into a single directory.

There are three types of files recognized by {\OKUSON} which are
distinguished by their file extensions as follows:
\begin{description}
\item[\texttt{.tex}] this is for text exercises, such a file
contains just the text of the exercise in \LaTeX-format.
\item[\texttt{.auf}] this is for files containing one or several interactive 
exercises, these are XML files with the actual exercise texts written in
\LaTeX.
\item[\texttt{.bla}] this if for files which specify one or several exercise
sheets. They contain some meta information like sheet number or submission
date and refer to the exercises to include, some intermediate texts can also
be given (in \LaTeX-format).
\end{description}

\subsubsection*{Which {\LaTeX} Macros?}

In the standard setup of {\OKUSON} the following packages and macros are 
loaded when \texttt{latex} is called: 

\begin{itemize}
\item \texttt{inputenc}, with parameter
\texttt{latin1} which allows to use German umlauts and other western
European accented characters in the {\LaTeX} code
\item \texttt{graphicx} for
including images in exercises 
\item  \texttt{amssymb} which provides many
mathematical symbols, and finally 
\item macros \verb+\Z+, \verb+\N+, \verb+\Q+, 
\verb+\R+, \verb+\C+, \verb+\F+ as
abbreviations for \verb+\mathbb{Z}+, and so on. 
\end{itemize}

The {\LaTeX} templates used for producing the images of exercise texts for
the web pages and for producing the exercise sheets in PDF-format can be
found (and adjusted, if you know what you are doing) in the {\OKUSON}
configuration  file \texttt{\$OKUSONHOME/Config.xml}, see the elements
\texttt{<LaTeXTemplate>} and \texttt{<PDFTemplate>}.

If you just want to add the loading of some further packages or to read in
some of your favourite personal macros, use the \texttt{<ExtraLaTeXHeader>}
element of the configuration file.

Note that if the {\LaTeX} runs need further input files like for example
images, you have to make sure that {\LaTeX} finds them in your filesystem.
This can for example be achieved by setting the environment variable
\texttt{TEXINPUTS}. Note that with the standard UNIX version of {\LaTeX}
you have to append a colon to the value of \texttt{TEXINPUTS} such that the
usual files for {\LaTeX} are still be found, i.e.~one has to use a command
like this before starting the server:

\hspace*{5mm} \verb!export TEXINPUTS='/path/to/additional/TeX/files:'!
\hspace*{5mm} (for \texttt{bash})

or

\hspace*{5mm} \verb!setenv TEXINPUTS '/path/to/additional/TeX/files:'!
\hspace*{5mm} (for \texttt{tcsh})

\subsubsection*{Comments in \LaTeX-Code}

The \LaTeX-code for exercises is used in the
\texttt{alt}-attributes of the images in the HTML version of the exercise
sheets. More precisely, a simple striping of comments is applied: lines
starting with a \texttt{\%}-character are deleted, and in other lines
everything after the first \texttt{\%}-character which is not preceded by
a backslash is removed. The images are generated with the non-striped input.

This behaviour allows to include references for solutions or solutions in
comments to the exercise.



\subsubsection*{Remark on the PDF-version of the Exercise Sheets}

The PDF-version of an exercise sheet shows exercises and questions in a
table with border lines between the entries. This should make it look
similar to the HTML-version of the sheet, such that the transfer of the
solutions of interactive exercises from the printed version to the web form
is easier.

This \LaTeX-input for the PDF-version uses the \texttt{longtable}
environment and the table entries are packed in \texttt{minipage}s. This
seems to be quite robust with the setup mentioned above. We had reports that 
sheets could not be compiled by {\LaTeX} with exercises using certain
environments from additionally loaded packages. While these are probably
bugs in one or some of the involved packages, it is difficult to find a
general strategy to avoid them. As a general rule, when something goes
wrong, try to enclose critical blocks by additional markup, e.g.,
enclose with \texttt{\{\ldots\}} or put text in some boxes.

\section{Writing Exercises}\label{sec:writeEx}

A text exercise used by {\OKUSON} is written in a separate file with
the extension \texttt{.tex}. Put only the \LaTeX-code of the exercise text
itself in that file.

We explain the format of an \texttt{.auf} file by an example that contains
all possible constructs. In practice one may copy the template file

\hspace{0.5in}\texttt{\$OKUSONHOME/exercises/empty.auf.template} 

and fill in the exercise texts.

\subsection*{An Example File \texttt{example.auf}}

This example  demonstrates all types of questions which can be posed
in interactive {\OKUSON} exercises. The example probably almost explains
itself, but read the comments below on the types of questions and how the
possible answers are specified.

{
\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE EXERCISE SYSTEM "exercise.dtd">

<EXERCISE key="Example1" keywords="">

<ANSWERS type="r">Yes | No</ANSWERS>

<TEXT>
Let $a = \frac{2}{3}$ and $b = \frac{14}{7} \in \Q$ and 
set $c = 3a + 5$ and $d  = a + 7b$.
</TEXT>

<QUESTION>
<VARIANT solution="Yes">
The numerator of $a$ is $2$.
</VARIANT>
<VARIANT solution="No">
The denominator of $a$ is $2$.
</VARIANT>
</QUESTION>

<QUESTION>
<ANSWERS type="c">b | c | d </ANSWERS>
<VARIANT solution="b|c">
Mark the number(s) which are integers.
</VARIANT>
<VARIANT solution=" d">
Mark the number(s) which are not integers.
</VARIANT>
</QUESTION>

<QUESTION>
<ANSWERS type="s"></ANSWERS>
<VARIANT solution="30">
What is $3d+c$ (canceled down)?
</VARIANT>
<VARIANT solutionregexp="^4$|^9$|^14$">
Give an integer which is the sum of two of the 
numbers $a, b, c, d$.
</VARIANT>
</QUESTION>

</EXERCISE>
\end{verbatim}
}

As  usual  for  XML  documents  the   first  two  lines  say  that  this  is
an  XML  encoded  document  whose  document type  is  described  in  a  file
\texttt{exercise.dtd}  and whose  content consists  of an  \texttt{EXERCISE}
element.

The document type definition  is contained in {\OKUSON}s \texttt{dtd} 
subdirectory. We now explain all elements in this example, these
explanations include the rules given in the document type definition.

The \texttt{EXERCISE} element  marks one exercise. Its content is a sequence
of \texttt{ANSWERS}, \texttt{TEXT} and \texttt{QUESTION} elements. 

\texttt{TEXT} elements are used for text appearing before (and maybe between 
or after) the actual questions of the exercise. Their content consists of
{\LaTeX} code.

There can be at most one \texttt{ANSWERS} element. If it is there it
describes a default for the answers to all questions of this exercise.
This element has the form 
\texttt{<ANSWERS type="?">? | ? </ANSWERS>} with three possibilities for
the \texttt{type} attribute:
\begin{description}
\item[\texttt{"r"}] (radio button) this is for questions where several possible answers 
are given and exactly one of them is correct. In this case the content of
the \texttt{ANSWERS} element is a list of strings for the possible answers
which are separated by \verb+|+-characters. Leading and trailing whitespace
in each possibility is removed (so that \texttt{>Yes|No<} and \texttt{>  Yes |
No <} are interpreted the same).
\item[\texttt{"c"}] (multiple choice) this is for questions where several
possible answers are given, and some subset of them is correct. This means
that one has to select \textbf{exactly} the right subset to score a 
point. The syntax for the content in this case is the same as for
\texttt{"r"}.
\item[\texttt{"s"}] (string) this is for question where the answer is
expected as a string (that has to be typed into an input field). In this
case the content of the \texttt{ANSWERS} element should be empty.
\end{description}

The \texttt{QUESTION} elements are for the actual questions. Their content
is a sequence of at most one \texttt{ANSWERS} element and at least one
\texttt{VARIANT} element. In case there is an \texttt{ANSWERS} element, this
must have the same syntax as just described and it is taken as description
of the answers to all variants of the current question. If there is no
\texttt{ANSWERS} element, the default given in the content of the
\texttt{EXERCISE} element is taken. 

The content of each \texttt{VARIANTS} element is the {\LaTeX} code of a
question. The correct  solution to this question is specified in one of the
attributes \texttt{solution} or \texttt{solutionregexp}, more precisely the
syntax depends on the answer type of the question:
\begin{description}
\item[\texttt{"r"}] the solution must be given in the \texttt{solution} 
attribute and be exactly one of the answers given in
the relevant \texttt{ANSWERS} element (again, up to leading or trailing
whitespace).
\item[\texttt{"c"}] the solution must be given in the \texttt{solution}
attribute and be a subset of the answers given in the relevant
\texttt{ANSWERS} element, separated by \verb+|+-characters.
\item[\texttt{"s"}] the solution can be given either in the
\texttt{solution} attribute as list of possible answer strings separated by 
\verb+|+-characters (usually just one string), or it can be given in the 
\texttt{solutionregexp} attribute as a regular expression such that an
answer is correct if and only if it matches this regular expression. To be
precise: the given expression must follow the syntax documented in the
\texttt{re}-module of \texttt{python}, the matching is done with the
\texttt{search} method of regular expression objects in that module.
In any case in the solutions and submitted answers leading and trailing
whitespace will be deleted before the comparison.
\end{description}

\subsection*{Several Exercises in One Document}

It is possible to put several exercises as above into one document. In that
case the document should look like

\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE EXERCISES SYSTEM "exercise.dtd">

<EXERCISES>

<EXERCISE>
   ...
</EXERCISE>
   
...

</EXERCISES>

\end{verbatim}

(note the entry \texttt{EXERCISES} in the \texttt{DOCTYPE} declaration).
There can be an arbitrary number of \texttt{EXERCISE} elements as explained
above.

\subsection*{Checking Exercises}\label{ssec:checkexercise}

The {\OKUSON} package contains a utility script for checking files with
interactive exercises as well as text exercises. 
The script assumes that you have the pager program
\texttt{less} and the image viewer program \texttt{xloadimage} (or some
other image viewer which you specify with an optional argument) installed on
your computer. The  script is called as follows:

\verb+          $OKUSONHOME/testexercise [-v viewer] file1 file2 ...+

where \texttt{file1}, \texttt{file2} are exercise files with either
\texttt{.tex} or \texttt{.auf} extension. 

For each \texttt{.tex} file the {\LaTeX} code is processed as configured in
your {\OKUSON} installation and the result is converted to an image. If
there was a problem with the call of \texttt{latex}, the pager program
\texttt{less} is called with the log file describing the error. 

Otherwise, if an image could be successfully generated, this image is shown
with the help of the  image viewer \texttt{xloadimage}. Except for
the pixel resolution this is the image used to display the corresponding
exercise text to the course participants in the HTML version of the exercise
sheets.

For each given name of an \texttt{.auf} file this utility first parses the
file and checks if it is a valid document. If not, some error
message is printed giving the exact position in the file where a 
problem occured.

After a successful parsing of the file the utility considers each piece of
{\LaTeX} code given in some \texttt{TEXT} or \texttt{VARIANT} element.
Each such piece of text is checked as described above for an 
exercise text from a \texttt{.tex} file.


\section{Specifying Sheets}\label{sec:Sheets}

For exercise sheets in {\OKUSON} there is another XML document type
definition which we will also explain by looking at an example. Files of
this type must have \texttt{.bla} as their extension. In these files,
interactive exercises are referred to by the value of their \texttt{key}
attribute, and text exercises are identified by their file names.

\subsection*{Example of an Exercise Sheet document}

\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE SHEET SYSTEM "sheet.dtd">

<SHEET counts="1" 
       magic="2003"
       nr="0"
       name="0"
       first="1"
       openfrom="12:00_01.09.2003"
       opento="14:00_20.10.2003">

<TEXT>The first exercise is interactive. You must send the 
solution via the web interface.</TEXT>

<EXERCISE key="Example1" prefix="" nrquestions="2" order="p" />

<TEXT>For the next exercise hand in a written 
solution to your tutor. </TEXT>

<INCLUDE file="fractions.tex"/>

<TEXT>Solutions for this sheet are accepted until 
Monday, Oct. 20, 2 pm.</TEXT>

</SHEET>
\end{verbatim}

The first two lines tell that the document is an XML document with a
document type specified in a file \texttt{sheet.dtd}.
The content of the file consists of a \texttt{SHEET} element.

A \texttt{SHEET} element has several attributes:
\begin{description}
\item[\texttt{nr}] must be the string of a non-negative integer. All sheets
must have different values for this attribute, which is used to order
all sheets numerically. 
\item[\texttt{name}] (optional, default value is value of \texttt{nr}
attribute) this is used as a name of the sheet that appears for example in
the header of the sheet, for example, it could be \texttt{name="Test 1"}.
\item[\texttt{first}] (optional, default value is \texttt{1}) fixes the
number of the first exercise on this sheet.
\item[\texttt{counts}] (optional, default value is \texttt{1}) determines if
this sheet is relevant for the grading of the course, value
\texttt{1} means \emph{yes} and value \texttt{0} means \emph{no}. 
\item[magic] string of some positive integer number smaller than $2^{32}$. This
is used in the pseudo-random choice of questions and variants in the
exercise sheets. Vary this value if you reuse a sheet or exercise to avoid
that people with the same identity get the same choices again.
\item[\texttt{opento}] this entry determines how long solutions for this
sheet are accepted. The value must be in the format \verb+hh:mm_dd.MM.yyyy+,
with \texttt{hh} the hour in the range $00..23$, \texttt{mm} the minutes in
the range $00..23$, \texttt{dd} the day of the month in the range $1..31$,
\texttt{MM} the month in the range $1..12$ and \texttt{yyyy} the year. This
time is interpreted as local time on the machine running the {\OKUSON}
server.
\item[\texttt{openfrom}] (optional, default is that the sheet is open
immediately) entry with the same syntax as
\texttt{opento}. If it is set to a time in the future then participants of
the course cannot get the sheet or submit solutions for it (But the
administrator can, so you can check and test a sheet before the course
participants can see it.) 
\item[\texttt{maxhomescore}] (optional, default empty) entry specifying the 
maximal number of points a participant can achieve in his written homework
exercises on this sheet. Up to now this is not used in the rest of the
system.
\end{description}

The content of a \texttt{SHEET} element is a sequence of any number of 
\texttt{TEXT}, \texttt{EXERCISE} and \texttt{INCLUDE} elements.

The \texttt{EXERCISE} elements are empty elements with some  attributes:
\begin{description}
\item[\texttt{key}] the value must be the same as for a \texttt{key}
attribute of some exercise read before by the {\OKUSON} server.
\item[\texttt{prefix}] (optional, default value is the empty string) only
matches an exercise with the correct \texttt{key} which was loaded with the
given prefix. (This allows the use of several exercise directories, which
may contain exercises with the same keys.)
\item[\texttt{nrquestions}] (optional, the default is the number of
questions available in the exercise) the number of questions from this 
exercise which should be pseudo-randomly chosen for each 
sheet (there can be more questions in the exercise).
\item[\texttt{order}] (optional, default value is \texttt{"p"}) the value
can be either \texttt{"p"} which means that the pseudo-random choice for the
exercise sheets will permute the given questions; or the value can be
\texttt{"f"} which means that the ordering of questions is fixed such that
the questions will appear in the given order on each sheet.
\end{description}

The \texttt{INCLUDE} elements are also empty and have an attribute
\texttt{file} whose value is interpreted as name of a file containing a
text exercise. There is also the optional attribute \texttt{prefix} with the
same meaning and default as for \texttt{EXERCISE} elements.

The \texttt{TEXT} elements contain {\LaTeX} code of text which is included
in the exercise sheets before, between or after the specified exercises.

\subsection*{Specifying Several Sheets in one File}

On can put several \texttt{SHEET} elements in one \texttt{.bla} file, but
these must be enclosed in a \texttt{SHEETS} begin and end tag, and the
\texttt{DOCTYPE} declaration must specify that a \texttt{SHEETS}
element is the top level element in the document.

\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE SHEETS SYSTEM "sheet.dtd">

<SHEETS>

<SHEET>
  ...
</SHEET>
...

</SHEETS>
\end{verbatim}


\subsection*{Checking Sheets}\label{ssec:checksheet}

The {\OKUSON} package contains a utility script \texttt{testsheet} 
for checking  sheet files.
It produces a {\LaTeX} file and a PDF file of the given sheets containing all
questions in all variants, and containing a list of solutions of all
interactive exercises. The layout of the exercises is exactly as it should
look in the PDF versions of the exercise sheets of the course participants.

It may be useful to check the individual exercises first with
\texttt{testexercise}, see~\ref{ssec:checkexercise}.

The syntax for this utility is

\verb+          $OKUSONHOME/testsheet file1.bla file2.bla ...+

For a sheet in \texttt{<file>.bla} with name \texttt{<name>} a {\LaTeX} 
file \verb+<file>_<name>.tex+ and a PDF file \verb+<file>_<name>.pdf+ 
are generated, if no error occurs.
These contain all variants of all questions and on an extra page the
solutions for the interactive exercises.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{The Web Pages}\label{ch:webpages}

We hope that the customization of the {\OKUSON} package for your 
application is possible by changing the basic entries in the
\texttt{Config.xml} file and by adjusting the template files for the web
pages delivered by the {\OKUSON} server. In this chapter we describe how the
web pages work. If you need further changes, please tell the {\OKUSON}
authors - maybe there are sensible generic extensions of the package which
fulfill your wishes.

\section{General Format of the Web Pages}

The web pages delivered by the {\OKUSON} server should be valid with
respect to a specification from the W3C consortium which is called
\texttt{XHTML 1.0 Strict}. These are combined with \texttt{CSS 2.0}
style sheets which are also specified by that consortium, details can be
found in~\href{http://www.w3c.org}{\texttt{http://www.w3c.org}}.

Furthermore, we avoid the use of client side programs like \texttt{java} or
\texttt{javascript}, plugins or other features of web browsers which 
some people tend to switch off. 

This may sound quite tedious and restrictive on a first glance, but we see
several advantages:
\begin{itemize}
\item Participants of the course need very little prerequisites, which are
nowadays available on essentially any computer. 
\item Strictly following some official standard should guarantee a
predictable and good appearance of the pages on all current web browsers
and all operating systems.
\item Having the page layout information (fonts, font-sizes, colors, border
sizes, \ldots) in style sheet files makes it easy to give all pages a
uniform appearance and to change this appearance for all pages at once.
\item Using the XML variant of the released HTML specifications allows to use 
standard tools for processing and checking such files (see
chapter~\ref{ch:introXML}).  Actually, most pages delivered by an {\OKUSON}
server are dynamically created from templates on demand. The templates are
also well-formed XML documents, which allow an efficient preparsing and
processing.
\item There are  developments like MathML which will allow in the future to
include mathematical formulae directly in web pages (currently, we use
images for that). Also, a systematic processing of XML documents on the client 
side is already possible in new web browsers. Such extensions will only work 
in combination with HTML pages which strictly conform to some official
specification.
\item We can include in our built-in web server an automatic check of the
validity of all delivered web pages. (Non valid pages are still delivered,
but they are saved in temporary files for debugging and the validator 
icon is removed.)
\end{itemize}

The {\OKUSON} package comes with a complete set of sample web pages, they
are in the subdirectory \verb+html.sample+. Of course, the text of web 
pages is language dependent. Our sample pages are
written in German since we use the package in Aachen. But it should be
straightforward to produce versions in other languages.

If you want German pages as well for your course,  just copy all the
sample pages to the web directory given in your configuration file. 
Probably  only minor adjustments will be needed for your course, see the
next section for more details.

All sample pages are provided as template files with extension
\texttt{.tpl}. These are well-formed XML documents and almost
\texttt{XHTML}, except for some extra tags.

The interface between the web pages and the {\OKUSON} server is described by
the meaning of these extra tags and by the names and meaning of input 
fields which are used in input forms for the course participants and for
the administrator. 

\section{How to Customize the Web Pages}

All web pages delivered by the  {\OKUSON} server are created by filling in
template files (with extension \texttt{.tpl}) dynamically.

The placeholders in  the \texttt{.tpl}-files are easy to detect: While all
element names in XHTML are written with lower case letters, the 
{\OKUSON} placeholders are XML elements whose names start with  capital
letters.

There are placeholder elements with a simple global substitution text, and
others which denote some text that depends on a sheet number or on personal
data of a course participant. If you browse through the template files
distributed with {\OKUSON} you can probably often guess the meaning of such
an element from its name and location. So, we are not going to describe
everything in too much detail here, but try to give hints how to achieve likely
adjustments of the pages.

\subsection{What You Can Change Without Problems}

\begin{itemize}
\item The style sheet files with \texttt{.css} extension to change colors,
fonts, font sizes, margins, \ldots
\item All texts in the pages.
\item In particular the top page \texttt{index.html} could be 
redesigned, but you clearly want to include  links to the main functions of
the server: registration, change of registration data, getting the exercise
sheets and result information.
\end{itemize}

\subsection{What You Should Not Change}

\begin{itemize}
\item The component names in the HTML forms, these names explain the meaning
of the input data to the {\OKUSON} server. But you can take out or add some
components in these forms as explained below.
\item The names of many template files. In particular those in the
\texttt{errors} and \texttt{messages} directories, these files are used by
the {\OKUSON} server for error and success messages, as well as some others
which are used for the output of  internal functions in the server
(\texttt{sheet}, \texttt{result}, \texttt{reg\ldots}, \texttt{group\ldots},
\texttt{admin\ldots}, \texttt{exquery}).
If you change other file names make sure that you change links to these 
pages accordingly.
\end{itemize}

\subsection{Globally Defined Elements for Use in All Web Pages}

The following elements appear in almost all \texttt{.tpl} template files. 
They are substituted 
by the content of the elements of the same name in your configuration file:

\texttt{<CourseName/>}, \texttt{<Semester/>}, \texttt{<Lecturer/>},
and \texttt{<Feedback/>}.

For customization you can use elements \texttt{<User1>}, \ldots,
\texttt{<User9>} in the configuration file \texttt{\$OKUSONHOME/Config.xml} 
and include their content in the web pages via tags \texttt{<User1/>}, 
\ldots, \texttt{<User9/>}.

Furthermore the following elements are generally useful:
\begin{description}
\item[\texttt{<ValidatorIcon/>}] which includes an image in
the \texttt{images} directory with a link to the validating service of the
W3C consortium (it is only included if a page \emph{is} actually valid).
\item[\texttt{<CurrentTime/>}] which is substituted by a string describing
the local time of the delivery of a page. To get this string in a local
layout set the environment variable \verb+LC_ALL+ of the user starting the
{\OKUSON} server appropriately (say \verb+de_DE+ for German, see the
\texttt{man} page of \texttt{locale} on your system, often \texttt{locale
-a} lists the available settings).
\end{description}

A few other elements are available on all pages, but they are only sensible in
a special context, we list them shortly, see the sample web pages how they
are used. The elements with \texttt{Group} as part of their name correspond
to a distribution of the course participants into smaller groups for
tutoring. If you do not have such groups, ignore these elements.
See~\ref{sec:groups} for more details.

\begin{description}
\item[\texttt{<GroupSize number="??"/>}] number of participants in group
with given number.
\item[\texttt{<GroupDistribution/>}] sequence of HTML table rows (ID, number of
group), sorted numerically or alphabetically by IDs.
\item[\texttt{<GroupsOverview components="\ldots"/>}] sequence of HTML table rows, 
one for each group. See the comment in the sample file
\texttt{groupoverview.tpl} and~\ref{sec:groups} 
for possible \texttt{components}.
\item[\texttt{<MembersOfGroup number="??"/>}] comma separated list of IDs of 
participants in group with given number.
\item[\texttt{<AvailableSheetsAsButtons/>}] row of buttons for all available
sheets,  for use on query page for sheets.
\item[\texttt{<AvailableResolutions/>}] a \texttt{select} environment
showing the resolutions configured in entry \texttt{<Resolutions>} of the
\texttt{Config.xml} file.
\end{description}

\subsection{Special Elements in Pages Containing Personal
Data}\label{ssec:regelts}

There are  two pages for registration, one for the actual
registration and one for changing the personal data, see the sample pages
\texttt{registration.tpl} and \texttt{regchange2.tpl}. 
Another page with personal data is the results page, see the sample
page \texttt{results.tpl}.

\subsubsection*{Registration and Change of Data}

The following registration data  for each participant are stored by the
{\OKUSON} server: a user id, last name, first name, the number of semesters the
participant has studied, (main) topic of studies, password (has to be given
two times when it is first specified or changed), 
email address, wishlist of other ids for distribution into
tutoring groups and nine further fields for customization.

Each of these fields is connected with three names used in the web pages.
The first is a name of the input field in the registration form, the second
is an XML element name of a placeholder for the input field code with the
known value as default (for changing the registration data) and the third is
an XML element name of a placeholder for the value itself.

Here is a table giving these names.

\begin{tabular}{lccc}
description&form input name& input element placeholder&value placeholder\\
\hline
user id&id&\texttt{<HiddenIdField/>}&\texttt{<IdOfPerson/>}\\
last name&lname&\texttt{<LastNameField/>}&\texttt{<LastName/>}\\
first name&fname&\texttt{<FirstNameField/>}&\texttt{<FirstName/>}\\
semester&sem&\texttt{<SemesterField/>}&\texttt{<Sem/>}\\
main topic&stud&\texttt{<TopicField/>}&\texttt{<Topic/>}\\
password&passwd and passwd2&-&-\\
email&email&\texttt{<EmailField/>}&\texttt{<Email/>}\\
wishlist&wishes&\texttt{<WishesField/>}&\texttt{<Wishes/>}\\
person data 1&persondata1&\texttt{<PersonData1Field/>}&\texttt{<PersonData1/>}\\
\ldots&\ldots&\ldots&\ldots\\
person data 9&persondata9&\texttt{<PersonData9Field/>}&\texttt{<PersonData9/>}
\end{tabular}

Concerning the main topic of studies, one can suggest some common entries
which are specified in the configuration file, see the element
\texttt{PossibleStudies} in the config file and the sample registration 
web pages.

There are further elements which can be used with the customization data
components in case these should  take only a fixed set of values:

\texttt{<PersonDataRadioButton name="persondata1" value="myvalue" />}, \\ 
\texttt{<PersonDataCheckBox name="persondata1" value="myvalue" />} and \\
\texttt{<PersonDataSelectOption name="persondata1" value="myvalue" }\\
\mbox{}\texttt{~~~~~~content="mycontent"/>},  

The first two produce an HTML \texttt{<input>} field of type  
radio button or check box,
respectively, which has the \texttt{checked} attribute set if the currently
stored value of \texttt{persondata1} is \texttt{myvalue} (and similar for
\texttt{persondata2}, \ldots). Note that {\OKUSON} stores only one value for
each component name. Instead of a component with multiple choices use
several components which can be switched on and off independently.

Similarly, \texttt{PersonDataSelectOption} produces an \texttt{<option>}
element for use with \texttt{<select>}. Its content is \texttt{mycontent}, its 
\texttt{value} attribute is \texttt{myvalue} and
its \texttt{selected} attribute is set if the currently stored value is
\texttt{myvalue}. In this case the \texttt{content} attribute is optional
and defaults to being the same as \texttt{value}.

\subsubsection*{Results Page}

On the results page with template \texttt{html/results.tpl} there are
also the following elements which produce personal data:

\begin{description}
\item[\texttt{<Results/>}] this is substituted by a 
sequence of HTML table rows, one
for each exercise sheet. The default entries of each row are the sheet name,
the number of points in the interactive exercises and the number of points
in the homework exercises. This can be customized by an attribute
\texttt{components}, for example if you don't have one of the exercise types
on your sheets. The default corresponds to 

\hspace{5mm}\texttt{<Results components="interactive,homework" />},

the order of results points could be exchanged, or one of the exercise types
can be left out. (Adjust the table header in the template appropriately.)

There are two more options \texttt{withMaxMCScore} and
\texttt{withMaxHomeScore} which lead to the display of the maximal possible
score after the score in brackets.
\item[\texttt{<TotalScore/>}] the total sum of all points in the interactive and
homework exercises.
\item[\texttt{<MaxTotalScore/>}] the total sum of all maximal possible 
points in the interactive and homework exercises.
\item[\texttt{<TotalMCScore/>}] the total sum of all points 
in the interactive exercises.
\item[\texttt{<MaxTotalMCScore/>}] the total sum of all maximal possible points 
in the interactive exercises.
\item[\texttt{<TotalHomeScore/>}] the total sum of all points 
in the homework exercises.
\item[\texttt{<MaxTotalHomeScore/>}] the total sum of all maximal possible 
points in the homework exercises.
\item[\texttt{<ExamGrade nr="??"/>}, \texttt{<ExamGrades/>}] the first is
substituted by a result string of a function given in the entry 
\texttt{ExamGradingFunction}, which is activated by
\texttt{ExamGradingActive}, in \texttt{Config.xml}, the function is called
with the given exam number as argument. The second element is equivalent to
a sequence of \texttt{ExamGrade} elements for all exams. See
chapter~\ref{ch:ExamOrga} for more details.
\item[\texttt{<Grade/>}] this works similar to 
\texttt{ExamGrade} but is for the
final grading of the course. See the configuration entries
\texttt{GradingFunction} and \texttt{GradingActive} in the
\texttt{Config.xml} file and chapter~\ref{ch:autograde} for more details.
\item[\texttt{<GeneralMessages/>}] this is substituted by the content of the
file configured in the entry \texttt{<GeneralMessageFile>} of 
\texttt{Config.xml} (\texttt{data/generalmessage.txt} by default).
\item[\texttt{<PrivateMessages/>}] this is substituted by message
lines collected for the specific participant in the file given by
the entry \texttt{MessageFile} in \texttt{Config.xml} (default is
\texttt{data/messages.txt}). The format of this file is described
in~\ref{sec:messages.txt}. You can add and remove individual messages
via the administrator menu, see~\ref{sendmess}.
\end{description}


\subsection{Special Elements for Sheet Specific Data}\label{ssec:sheetelements}

There are some special elements used with the sheets in HTML format.

\begin{description}
\item[\texttt{<SheetNumber/>}] number of sheet.
\item[\texttt{<SheetName/>}] name of sheet.
\item[\texttt{<IfOpen>\ldots</IfOpen>}] content only included if sheet is still open.
\item[\texttt{<IfClosed>\ldots</IfClosed>}] content only included 
if sheet is no longer open.
\item[\texttt{<HiddenIdOfPerson/>} and \texttt{<HiddenNameOfSheet/>}] 
hidden input fields for submission form.
\item[\texttt{<WebSheetTable/>}] the actual table rows for the sheet, 
entries are images with exercise texts, includes input fields for submission of
interactive exercises.
\item[\texttt{<OpenTo/>} and \texttt{<OpenFrom/>}] closing and opening times
of sheet in readable format (same format as explained for  
\texttt{<CurrentTime/>}). 
\end{description}

\subsection{Special Elements for Tutoring Group Specific
Pages}\label{ssec:groupelements}

All information about tutoring groups is also exported for use on web pages
related to one such group. In~\ref{sec:groupinfo} it is explained how
this information can be given to the {\OKUSON} server.

\begin{description}
\item[\texttt{<GroupNumber/>}] the number of the group.
\item[\texttt{<GroupTutor/>}] the name  of the tutor of the group.
\item[\texttt{<GroupPlace/>}] place where the group meets.
\item[\texttt{<GroupTime/>}] time when  the group meets.
\item[\texttt{<GroupEmailTutor/>}] the email address of the tutor of the group.
\item[\texttt{<GroupIDs/>}] a comma separated sorted list (numerically or
alphabetically) of the IDs of the participants.
\item[\texttt{<GroupInfo1/>} to \texttt{<GroupInfo9/>}] further unspecified 
data for customization.
\end{description}

\subsection{Special Elements for Administration Pages}

The administration and tutor pages use templates similar to the other pages
described so far. But since there is little need to adjust the
administration pages (explained in chapter~\ref{ch:adminpages}), we do not
document the helper elements here. They are almost self explaining or else 
look in the code. If you want more functions in the admin menu, please, tell us
about them. Maybe they are of general interest and we want to add them to
the {\OKUSON} package.

\chapter{Administration via the Web Interface}
\label{ch:adminpages}

The configuration of the {\OKUSON} system and the creation of exercises and
sheets works with an ASCII text editor. For some other administrative tasks
however, the {\OKUSON} server offers a convenient web interface. You can
reach this by pointing your browser to the following URL, when the {\OKUSON} 
server is running:

\hspace*{5mm}\href{http://localhost:8000/adminmenu.html}%
{\texttt{http://localhost:8000/adminmenu.html}}

This assumes, that the {\OKUSON} server is running on the same machine than 
your web browser. If this is not the case, you have to substitute the name
of the server machine for ``\texttt{localhost}''. The same applies for the
port number \texttt{8000}, if you have configured your {\OKUSON} server
to listen to another port.

Note that there is an extra configuration option 
\texttt{AdministrationAccessList} to limit the IP range of machines, from
where the administration pages can be accessed (see 
the comment in the \texttt{Config.xml} sample file). 
The default setting is to allow administrator
access only from the local machine (\texttt{localhost}).

In addition you have to authenticate yourself to the {\OKUSON} server
for every administrator operation. You can do this by entering the 
administrator password every time you start an operation. To make live
a bit easier we offer a cookie-based login procedure for this purpose to
avoid repeated password input. This works as follows:

To log in you have to visit the URL

\hspace*{5mm}\href{http://localhost:8000/adminlogin.html}%
{\texttt{http://localhost:8000/adminlogin.html}}

and type the administrator password. After login you are led to the
administrator menu, however, a secret number for this login session is
stored in your browser in a cookie. As long as the {\OKUSON} server is
not terminated and your browser still has this cookie value and you do
not login anew, you can perform administrative tasks without further
authentication. There is an option at the top of the administrator menu 
to log out again.

Note that the communication between your browser and the {\OKUSON} server is
not encrypted, such that everybody listening along the way could possibly
get administrator access. Therefore you should limit the administrator
access via the abovementioned IP ranges and log out after you are done
with administrative tasks.

\section{Administrative Tasks in the Administrator Menu}

You have the following options in the administrator menu:

\subsection{Restart server} 

This stops the {\OKUSON} server gracefully
and restarts it immediately. This is the same as launching the \texttt{restart}
script in the {\OKUSON} home directory. Note that you have to log in again
for further administrative tasks, as the login session is terminated 
automatically.

\subsection{Stop server} 

This stops the {\OKUSON} server gracefully.
This is the same as launching the \texttt{stop} script in the {\OKUSON}
home directory.

\bigskip
\textbf{Comment:} 
The following options are for data exports. They all send a file with
content type ``\texttt{text/okuson}'' and your browser probably will
ask you to save the file, because it does not know what to do with this
content type. In all cases we send sensible default names along. 

\textbf{Attention:} If you choose in your browser some helper application
to view these exports, it may very well be that the exported files are
written into some global temporary directory like \texttt{/tmp}. It is
of course your responsibility to ensure proper data protection for this
at least potentially critical personal data!

\subsection{Export people for tutoring group distribution} 
\label{sec:exppeotut}

With this option
you can export data about all registered participants for the purpose of
distributing them into smaller tutoring groups. Usually this will be 
a semi-automatic process that is described in chapter \ref{ch:managepeople}
below.

\subsection{Export people} 

With this option you can export the personal
data of all registered participants into a single ASCII file.

In the file exported there is --- after some comment
lines beginning with a \#-character --- one line for every participant.
This line comes in the same format as the file \texttt{data/people.txt}
(see \ref{sec:people.txt}), \textbf{except} that there is an additional
field, namely the number of the group in which the person is.

This means, that there are three reasons, why you should \textbf{not} copy
the output of this export directly to the file \texttt{data/people.txt}.
Apart from making no sense at all, you have to remove the last data field
with the group, and, what is probably worse, all colons and newlines that
may be contained in personal data fields are deleted or replaced by a 
space respectively, whereas in \texttt{data/people.txt} special precautions
are taken to store such data (see chapter \ref{ch:fileformats}).

So the fields in \texttt{peoplelist.txt} are separated by colons and
arranged in the following order:

\begin{center}
\begin{tabular}{|l|}
\hline
ID \\
\hline
last name \\
\hline
first name \\
\hline
semester number \\
\hline
studiengang \\
\hline
encrypted password \\
\hline
email address (possibly empty) \\
\hline
wishlist as typed in \\
\hline
personal data \#1 \\
\hline
personal data \#2 \\
\hline
personal data \#3 \\
\hline
personal data \#4 \\
\hline
personal data \#5 \\
\hline
personal data \#6 \\
\hline
personal data \#7 \\
\hline
personal data \#8 \\
\hline
personal data \#9 \\
\hline
group number ($0$ if not in any group) \\
\hline
\end{tabular}
\end{center}

You can choose among a number of orderings. There seems to be no immediate
application of this export facility, but it offers easy access to the
available personal data for private scripts and standard UNIX text
tools.

Our intention for this export is to be able to access the current data
in the server easily with private scripts.


\subsection{Export participants of exam} 
\label{sec:expexamreg}

This export facility is to get
information about the registration situation for exams. Therefore the
exported data is restricted to ID, name, first name and the time stamp 
of the registration. The file format is as follows: For every participant
there is one line that contains the abovementioned fields, separated by
colons. See chapter \ref{ch:ExamOrga} for a description of how to
organize exams conveniently.

\subsection{Export results} 
\label{sec:expresults}

This export facility produces information
about all the results of the participants, including multiple choice
exercises, homework exercises, and exams. The data format is as follows:
There is one line for each participants with fields separated by colons.
The fields and their order can be read off the following table:

\begin{center}
\begin{tabular}{|l|}
\hline
id \\ \hline
last name \\ \hline
first name \\ \hline
group number \\ \hline
total score in multiple choice exercises \\ \hline
total score in written homework exercises \\ \hline
total score \\ \hline
generated message from automatic grading function \\ \hline
grade from automatic grading function \\ \hline
a string of all exam results and grades, separated by semicolons \\ \hline
for every sheet one more field, see below \\ \hline
\end{tabular}
\end{center}

Note that the fields generated by automatic grading are there but empty, if 
automatic grading is switched off. For each exam the participant has a data
field, there are two parts of information exported (separated by
semicolons): the score in the exam and the grade, as calculated by the
automatic grading function for exams. If a participant has a data field for
some exam (for example if he has registered for this exam), but did not
take part, the string ``\texttt{-;0}'' is exported as his result for
that exam. If automatic grading of exams is switched off, the grade
exported is always 0. So the exams data field is an alternating list of
entries, all separated by semicolons, for each exam an entry for the
score, followed by an entry for the grade. At the end of the line, there
is for every closed sheet a field with sheetname, multiple choice score
and homework score, separated by semicolons.

The obvious application of this export is at the
end of the semester to produce certificates for successful participants.

\subsection{Show Exercise Statistics for sheet}

With this option you can display statistics about numbers of participants.
For every variant of questions the number of participants who have
got this variant, the number of participants who answered the question, and
the number of participants who answered the question correctly is shown
with a nice graphical display. Color coding is used to mark extreme
cases.

\subsection{Show Global Statistics}

With this option and the next one you can display statistics about the
distribution of scores, separated by tutoring group and sheet, and by
homework and multiple choice. The distributions are shown as total numbers, 
as percentages, and as histograms.

\subsection{Show Global Statistics, separated per Group, for sheet}

See above.

\subsection{Display available and future sheets} 

This option gives the administrator access to a page to display sheets
exactly as the page for regular participants, except, that also future
sheets (which have not yet reached their \texttt{openfrom} date) are
accessible.

\subsection{Send message} 
\label{sendmess}

With this option one can send an individual message to a certain
participant. This message will appear on the page where the participant
queries his results. More than one message is possible. All messages
are stored in the file \texttt{data/messages.txt}. The format of this
file is described in section \ref{sec:messages.txt}.

This messaging system can also be used to automatically produce individual
messages for all participants. In this case it is probably better not to
type in the messages via the web interface, but to append the messages directly
to the file \texttt{data/messages.txt}.

Remember the possibility to display a general message on the result pages
of all participants via the file \texttt{data/generalmessage.txt}
(see section \ref{sec:generalmessage.txt}).


\subsection{Delete messages of}

With this option you can delete a subset of the private messages of one
participant. To this purpose one gets a display of all messages and can
choose the subset to delete. Note that this deletion is not really a 
deletion but more a ``revocation''. A ``deleted'' message is just repeated
as a new message with a dollar sign \verb!$! prepended in the internal
data format. The participant of course does no longer see revocated messages.
In this way, no message is ever lost.

\subsection{Reevaluate participants' answers for sheet}

This options comes in handy if the unfortunate case happens (and it will
happen eventually, believe it or not!) that a ``correct'' solution was
entered incorrectly in the exercise description. One has to know that
the evaluation of the submission of a participant happens at the time
of submission and is then cached in memory (and on disk). Therefore later
changes in the correct solutions in the exercise source files are \textbf{not}
considered without manual intervention!

To this end, one can select this option and reevaluate all submissions of
all participants for a certain sheet.


\chapter{Managing Participants}\label{ch:managepeople}

\section{Registration of Participants}

Once you start the server, participants can register via the {\OKUSON} web 
interface without  any administrational interaction. Registration is
possible as long as the service is running. 

Among the sample web pages coming with {\OKUSON} the template files
\texttt{registration.tpl} and \texttt{regchange2.tpl} are used for the
initial registration and change of personal data, respectively. 

Before you start the service check if the personal data collected on these
pages are what you need in case of your course. It is advisable to ask for
all data you may need later, e.g., for the grading and a possible
certificate in the end of the course. In chapter~\ref{ch:webpages} we have
explained the customization of the web pages, in particular in
section~\ref{ssec:regelts} we mentioned some customization variables you can
use for additional data. On the other hand you can just delete input fields 
in the registration pages which you do not need.

The most important datum of a registration is the ID of the participant,
which cannot be changed later. All data concerning a specific course
participant are stored by {\OKUSON} together with the corresponding ID.


\subsubsection*{IDs of Participants}

In our university there is a natural ID for each student (the "Matrikel" 
number)  which is often used. If you want to use other types of IDs, e.g.,
login names of the students choice, you can customize  the configuration option
\texttt{IdCheckRegExp} in \texttt{Config.xml}.

\subsubsection*{Visitor IDs}

Sometimes it is useful to have some visitor IDs which can be used with
arbitrary password and which do not appear in the export of user data or
result statistics. {\OKUSON} has the configuration option 
\texttt{GuestIdRegExp} for specifying such IDs.


\section{Distributing Participants into Tutoring Groups}\label{sec:groups}

We always accompany our exercises with regular meetings in a number of 
smaller groups with an assigned tutor. (The tutors check and grade the written
solutions of non-interactive exercises, and they discuss all exercises with
their group.)

You can tell the {\OKUSON} server about the membership of a course
participant in a tutoring group by numbering the groups (starting from 1,
the number 0 is a default number for people not (yet) put in one of those
groups), and by appending a line of the form

\verb+   someid:groupnumber+

to the file \texttt{data/groups.txt} (more precisely, the file configured
by \texttt{GroupFile}).

But, as you may know, for bigger courses, this distribution 
of the participants into tutoring groups is not easy, at least if you
want to fulfill wishes of participants to be together with some others.
{\OKUSON} helps you to complete this task in the following ways:

First (already at registration time), participants can enter a wishlist
of other students' IDs with whom they want to be in the same group. {\OKUSON}
offers one input field, where participants can basically type in IDs of
other participants, usually separated by commas or whitespace.

Secondly you can export all registered people via the administrator pages 
(see \ref{ch:adminpages}) using the button ``Export people for tutoring group
distribution''. You have the choice of exporting all participants together
(option ``all together'') or separated by their course of studies. Also you
can choose the data fields by which the output is sorted. The result
of this export is an ASCII file in a certain format (see
\ref{distribute.py}), that contains basically the IDs, the first and
last names, the semester number, the course of studies, the wishlist and
possible additional data you may collect of each participant.

This file is sent to your web browser with the content type 
\texttt{text/okuson}. This usually means that your browser --- not
knowing this type --- asks you, where it should store this file. It should
offer the default file name \texttt{peoplelistforgroups.txt}. Once you have
saved this file on your hard disk, you can use the following two scripts
in the \texttt{scripts} directory of your {\OKUSON} home directory:
\texttt{distribute.py} and \texttt{numbergroups.py}. The first
does a distribution of participants into groups thereby
fulfilling the wishes of participants as far as possible and forming as
many groups as you order. The second script just takes the result and
brings it in a format suitable to reimport it into {\OKUSON}. The 
result of \texttt{numbergroups.py} can be appended to 
\texttt{data/groups.txt}. After the next server restart the new
information is available to the {\OKUSON} server.

\subsection{Usage of \texttt{distribute.py}}

\label{distribute.py}

The input to \texttt{distribute.py} is an ASCII file with one line for
each participant (plus extra lines, see below). Each such line has to
be in the following format:

\hspace*{5mm}\texttt{id:last name:first name:semester:studiengang:wishlist:\ldots}

where \texttt{wishlist} is a comma separated list of valid IDs and the dots
in the end mean the 9 customization data \texttt{persondata1}, \ldots, which
may be empty. Lines
beginning with a hash \# character are ignored as comments. Empty lines
play a special role,  they separate so called ``parts'' of the
input. If for example you want to form groups for participants
of some course of studies separately, you can just separate the lists of
participants by empty lines, which is also done by the {\OKUSON} server,
if you select the option ``by course of studies'' during export. Via the
sorting options it is also easy to split into parts by other criteria.

The output of \texttt{distribute.py} has the same format, except that
empty lines now separate the groups into which the script has divided the
participants. Some comment lines have been added.

What does \texttt{distribute.py} do?

First it calculates for each part the finest equivalence relation with the
property, that all wishes (within the part) are fulfilled in the sense,
that any two participants where one had the other on his wishlist, are in
the same equivalence class.

Then it distributes these equivalence classes into a number of groups you
have specified on the command line (see below). To this end it uses the
following simple algorithm: It always puts the biggest equivalence class
left into the smallest group available. This algorithm works amazingly
well, because usually you will have lots of people without wishes, which
help to fill the groups in the end. Occasionally there will be one
equivalence class which is too big, thereby making one exercises class
which is bigger than all the others. See below how to overcome this
problem.

\texttt{distribute.py} is called with the following command line arguments:

\hspace*{5mm} \verb!scripts/distribute.py INPUTFILE OUTPUTFILE GROUPS {GROUPS}!

where \texttt{INPUTFILE} is replaced with the name of the input file,
\texttt{OUTPUTFILE} is replaced by the name of the output file and
these two file names are followed by as many numbers as there are parts
(separated by empty lines, see above) in the input. Each number specifies,
how many groups should be formed out of the corresponding part. 

\textbf{Note} that the output file is overwritten and therefore should
be different from the input file.

The information about the equivalence classes is preserved in the following
way: between any two equivalence classes within the same group a comment
line is added, indicating the delimiter between equivalence classes.

\subsection{Usage of \texttt{numbergroups.py}}

The usage of \texttt{numbergroups.py} is even simpler. It is  called in
the following way:

\hspace*{5mm} \verb!scripts/numbergroups.py INPUTFILE OUTPUTFILE [FIRSTGROUP]!

where \texttt{INPUTFILE} is replaced with the name of the input file,
\texttt{OUTPUTFILE} is replaced by the name of the output file, and
\texttt{FIRSTGROUP} is an optional argument which selects the number
of the first group and defaults to $1$.

The script \texttt{numbergroups.py} just reads in the input file, reads
empty lines as group delimiters, ignores comments and writes out the
group distribution in the format the {\OKUSON} server needs it in the
file \texttt{data/groups.txt}. The import works just by appending the
result of \texttt{numbergroups.py} to the file \texttt{data/groups.txt}
and restarting the server.

\subsection{Strategies for Distribution}

We found that often the following strategy was good enough:

\begin{enumerate}
\item Export people ``all together''.
\item Run \texttt{distribute.py} once with the number of groups you want to
have.
\item Look at the output on the screen and decide whether the group sizes
are suitable.
\item Run \texttt{numbergroups.py} to prepare the input for {\OKUSON}.
\item Append it to \texttt{data/groups.txt} and restart the server.
\end{enumerate}

Because of the nature of this procedure with many intermediate steps you
can do manual interventions at all stages. For example you can divide the
output of the {\OKUSON} server by hand in a number of parts which are
handled separatedly. Or you can play around with the number of groups
(note that using $1$ for the number of groups basically gives you
statistics about the equivalence classes). In this way, you can overcome
problems with too big equivalence classes by manually separating them
into different parts. At last you also can look at the output of 
\texttt{distribute.py} and change the distribution before importing it
into the {\OKUSON} server via \texttt{numbergroups.py}.

Note finally that you can also separate different parts of the input into
different files manually and run the scripts on these files separately.
In the end you can put everything together by choosing the
\texttt{FIRSTGROUP} argument of \texttt{numbergroups.py} accordingly.

We hope that this whole procedure is flexible enough for all situations.

\section{Importing Information About the Tutoring
Groups}\label{sec:groupinfo}

If you are using the distribution of the course participants into tutoring
groups, there are pages among the {\OKUSON} sample web pages for publishing 
information on each group: number, meeting place and time, tutor, contact
address and also further infos that can be freely customized, see the
templates \texttt{groupoverview.tpl} and \texttt{groupinfo.tpl}. There is
also an encrypted password for each group. This can be used (and changed) by
the groups tutor for sending grading results of non-interactive homework 
exercises to the {\OKUSON} server, see below. The placeholder elements in
these template files are described in~\ref{ssec:groupelements}.

The import of these data for the existing groups is by appending one line
per group to the text file \texttt{data/groupinfo.txt} (more precisely, the
file  configured in entry \texttt{GroupInfoFile}). Each such line is a
sequence of entries separated by colons \texttt{:}. The entries are
interpreted in the following ordering:

\begin{description}
\item[nr] number of the group, a positive number.
\item[passwd] encrypted password for the tutors input access.
\item[tutor] name of tutor.
\item[place] place of group meeting.
\item[time]  time of group meeting.
\item[email] email address of tutor.
\item[groupinfo1 to groupinfo9] freely usable variables for customization.
\end{description}

Note that you could give pieces of HTML code containing appropriate links as
some of these entries. Note also that entries are separated by colons, within 
the entries you can encode a colon by typing \verb+\d+ instead.

\section{Input of Homework Results by Tutors}
\label{sec:tutpage}

There is a web page \texttt{/tutors.html} where tutors can request input
forms for homework exercise results, either for a particular member of the
group and all sheets, or for a particular sheet and all members of the
group. The group's password is needed for accessing these forms. This
password can also be changed via this request page.

Each result must be given in form of a total score and (maybe optionally) a
comma separated  list of partial results. You may specify the optional
\texttt{maxhomescore} attribute for your exercise sheets for later use with
grading or statistics.


\chapter{Managing Exams}
\label{ch:ExamOrga}

Unfortunately, we have no idea how {\OKUSON} can help with checking and
grading written exam exercises.

Nevertheless, there is functionality for the administrational aspect of
exams, this is explained in this chapter: Registration for exams, 
importing exam results in the {\OKUSON} server, displaying the results.

{\OKUSON} handles some information about exams for each participant. 
Exams are numbered from $0$ to a certain limit, which is $23$ at the 
moment. The information stored is basically the fact, whether a certain 
person wants to take part in the exam, and if so, the result in the form
of one non-negative integer score as the final result and an additional
string, which can be anything, for example intermediate results. The
{\OKUSON} system will only store this string and will not further process
it, except the user supplies functions to do so (see below).

The result of exams can enter the automatic grading decision at the end
of the course (see \ref{ch:autograde}).


\section{Registration for Exams}

There is already a web page prepared to organize the registration of 
participants for exercises. It is stored in the template 
``\texttt{examregistration.tpl}'' in the root directory of the
web pages (usually ``\texttt{html}'' in the {\OKUSON} home directory).

In the default setting this page is not linked from anywhere else, such that
participants will not visit this site accidentally. Note however, that
one can reach this page by typing in the correct URL right from the beginning
of the course. Therefore the form for submission of the registration is
commented out, such that it does not appear on the page. Of course, a
participant knowing the details can submit registrations ``by hand'' anyway.

To activate the registration, one has to do the following: 
\begin{itemize}
\item ``Comment in'' the form in \texttt{examregistration.tpl}.
\item Edit the attribute value for ``\texttt{nr}'' in the input field
in the line marked ``\texttt{***please edit***}'' to the exam number, for
which you want registration.
\item Delete the string ``\texttt{***please edit***}'' in the same line.
\item Edit the text around this to your needs.
\item Activate the menu entry ``Klausuranmeldung'' in the main menu in the
file \texttt{index.tpl}.
\item Restart the server.
\end{itemize}

From the moment you do the last step, participants can register (and 
deregister) for the exam in question.

The collected information is stored in the file \texttt{examregistrations.txt}
in the \texttt{data} directory. However, you do not need to know its format,
because there is export functionality for these registration information via
the administrator menu (see section \ref{sec:expexamreg}).

Please note again that even if you take the registration page from the
web pages, people knowing the details can still submit registrations and
deregistrations ``by hand''.

\section{Importing Exam Results into the Server}

The results of exams are put directly into the data file \texttt{exams.txt}
in the \texttt{data} directory. See section \ref{sec:exams.txt} for the
file format. This file will never be written by the {\OKUSON} server. 
Therefore it is save to append data while the server is running. After 
a restart, everything is available within the {\OKUSON} system.

Note that without further intervention, no result is displayed publicly.
However, in the export option for results (see \ref{sec:expresults}) the
data appears.

\section{Displaying Results of Exams automatically}

To display the exam results on the usual result pages, there are two
special configuration options. The basic idea is, that the administrator of
the {\OKUSON} server supplies a function that produces the output that
should appear on the web page. 

This works as follows: There is a configuration option 
\texttt{ExamGradingActive}. The automatic exam grading is active if 
and only if the value of this integer is non-zero. For this case, there
is the configuration option \texttt{ExamGradingFunction}, which contains a
Python function with the name ``\texttt{Grade}'' that is called with
two arguments, the first being an object of type \texttt{Person} (see
chapter \ref{ch:intdata}), containing all the personal data of one
participant, including information about exams (in the \texttt{exams}
entry). The second argument is the number of the exam in question.
This function is called when the result page for a participant is
generated for all exams that participant took part in.

The \texttt{Grade} function has read access to the personal and exam data
and has to return a pair. The first entry of this pair has to be a string,
which is put in a ``\texttt{<p> </p>}'' environment on the web page, if you
use the \texttt{<ExamGrades/>} element. The
second entry is a grade, which is later exported in the result export.
This grade has to be a number (int or float) and is converted into a 
string during export.

Note that of course you can refrain from using this feature altogether,
produce the output for the results display externally with your own tools
and import this into standard private messages in the file \texttt{message.txt}
(compare sections \ref{sendmess} and \ref{sec:messages.txt}). 

\chapter{Automatic Grading}
\label{ch:autograde}

At the end of the semester there will usually be some kind of grading
procedure. This can be as simple as deciding which participant passes
the course and gets a certificate of participation (``Schein'') or can
be more involved like coming up with a ``grade'' of some sort. 

Usually the data going into such decisions is known to the {\OKUSON}
system (scores from multiple choice exercises, scores in non-interactive
exercises, results of exams). Therefore it seems natural to give the
task of grading to the {\OKUSON} system as well as giving out the
information about their results to the participants.

There are two ways to do this: The first is using the automatic grading
facilities of {\OKUSON} described in this chapter and the second works
by exporting all the result data as described in section
\ref{sec:expresults}, using external tools for the decision and reimporting
the information back into the {\OKUSON} system as private messages
(see sections \ref{sendmess} and \ref{sec:messages.txt}).

Due to the big variety of possible grading algorithms, one has to learn
to write a little Python function to use automatic grading.

There are two configuration options for automatic grading:
\texttt{GradingActive} and \texttt{Grading\-Function}. The first is integer
valued and the automatic grading functionality is switched on if and only if
its integer value is non-zero.

Once automatic grading is switched on, the entry
\texttt{GradingFunction} is used (the sample configuration file
\texttt{Config.xml.sample} in the {\OKUSON} distribution has an example
function, which is shown below at the end of the chapter). It has to
contain a Python function \texttt{Grade}, which takes $5$ arguments:
An object of type \texttt{Person} (see \ref{ch:intdata}), then a list
\texttt{sl} for the available sheets, the total score of the person in
all multiple choice exercises, the total score in all written homework
exercises, and finally a list of integers of length $24$, where each
number corresponds to one exam, numbered from $0$ to $23$. A value of
$0$ stands for either $0$ points or for the fact, that this person did
not take part in the exam. This list is for programmer's convenience
only, as this information is contained in the personal data of the
person anyway. There one can also read off, whether the person actually
did take part in a certain exam or not.

The function has to return a pair, where the first entry is a string which
is put between a ``\texttt{<p> </p>}'' on the results page, if the
element \texttt{<Grade />} is present in the template file. The second
entry is a number (float or integer), that is stored as the grade.
It is later exported along with the other results. You can for example use
the grade as a flag, whether somebody passed the course or not.

With the automatic grading facility you can devise nearly arbitarily 
complicated conditions for the grading decision. You have read access to
all personal data and the whole {\OKUSON} system.

Note however that it is strictly forbidden to change any global data in the
{\OKUSON} server. The reason for this is that the server is multi-threaded,
every web access has its own thread and any change in global data has to
be protected by certain locking mechanisms to avoid possible internal
data corruption. Bugs coming from such misuse will show up only
occasionally and will be extremely hard to find!

Here is the example function from the example configuration file:
\begin{verbatim}
def Grade(p,sl,mcscore,homescore,exams):
    '''This function decides about the grade of person p. 
       sl is a list of sheets as returned by the function
       SheetList in the Exercises module. mcscore is the
       total sum of points in all closed sheets with counts
       value equal to 1. homescore is the total sum of
       points in the homework and exams is a list of length
       at least 24 with one score corresponding to each of
       24 exams (indexed from 0 to 23). If the participant
       did not take part in an exam, there is a zero in the
       corresponding position.'''
    if (mcscore+homescore >= 240 and 
        (exams[0]+exams[1] >= 50 or
         exams[2] >= 50 or
         exams[0]+exams[2] >= 50 or
         exams[1]+exams[2] >= 50)):
        return ('Sie bekommen den Schein.',1)
    else:
        return ('Sie bekommen leider keinen Schein.',0)
\end{verbatim}

\chapter{File Formats}
\label{ch:fileformats}

The data files of the {\OKUSON} system all reside in the \texttt{data}
directory in the standard configuration. They are all extended ASCII files
(usually with the ISO-8859-1 8 bit encoding) and have the following
standard format:

\begin{itemize}
\item Lines are separated by newline characters (ASCII code 10), i.e.~UNIX
line ends.
\item Empty lines are ignored.
\item Lines where the first non-whitespace character is a hash character ``\#''
are treated as comments and are ignored.
\item Every line that is not ignored stands for a data record.
\item For each file there is a field separating character (usually a colon
``:'') and one can access all the fields in a line simply by splitting
the line at all occurances of the separating character. If the value of a 
data field actually contains the separating character it is protected as 
described below.
\item After reading an input line, the following procedure is applied
to every data field (after the split):
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
replace & \verb!\d! & by the delimiter \\
\hline
replace & \verb!\n! & by a newline \\
\hline
replace & \verb!\r! & by a carriage return \\
\hline
replace & \verb!\c! & by a hash mark \# \\
\hline
replace & \verb!\e! & by a backslash \\
\hline
\end{tabular}
\end{center}
\item Before writing an output line, the following procedure is applied
to every data field (before joining fields with the separator in between):
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
replace & every backslash & by \verb!\e! \\
\hline
replace & every delimiter & by \verb!\d! \\
\hline
replace & every newline   & by \verb!\n! \\
\hline
replace & every hash character \# & by \verb!\c! \\
\hline
replace & every carriage return & by \verb!\r! \\
\hline
\end{tabular}
\end{center}
\item The last two points ensure that data lines contain delimiter characters
only between fields and that backslashes are followed only by one of the
characters ``cdenr''. Therefore, arbitrary string values can be put into
data fields within one line.
\item There is one exception for the empty list: It is stored as the special
value ``\verb+\0+'' (a backslash followed by a zero) to distinguish it from
the list containing exactly one empty string.
\item In every file one of the fields is the ID that identifies the person 
to which the data belongs.
\item There is the following principle: New data is \textbf{always appended}
to the file and \textbf{never deleted}. Therefore, at any given time, 
\textbf{the last value with a certain ID} is the one that counts. The
reason for this is that appending is more efficient than writing the
file anew and that it is guaranteed, that every piece of information in
the memory of the server is also saved to disc at all times.
\end{itemize}

Whereas the format of the file makes it easy to use external standard UNIX
tools to access all the information, the last principle somehow ruins this,
because one always has to sort out the last valid value. We strongly recommend
to use the export facilities described in sections \ref{sec:exppeotut}
to \ref{sec:expresults} to access data, because they do not impose this
difficulty.

However, we see certain applications (mainly data import) to access
the files described in this chapter, therefore it is worthwhile to
document the format.

Note that the fundamental idea of data management in the {\OKUSON} system
is, that data is read in at server startup from the files in the
\texttt{data} directory. The data is then stored in internal data
structures. As mentioned above, when more than one line in a file
corresponds to the same ID, the last one counts. During the runtime of the
server the data is kept in memory and on disc. Every single change is first
appended to the data files on disc and then entered into the data
structures in memory, such that consistency even after a server breakdown 
is guaranteed.

\section{\texttt{data/people.txt}}
\label{sec:people.txt}

The general comments about file formats at the beginning of this chapter
apply also to \texttt{data/people.txt}. The delimiter character for this
file is a colon ``:''. 

Each line of the file corresponds to the personal data of one participant
and contains the following data fields (in the third column some
comments about the data type are displayed):

\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Name of field & Description & Data type \\
\hline
\hline
id & Identification & string \\
\hline
lname & Last name   & string \\
\hline
fname & First name  & string \\
\hline
semester & Number of semester & non-negative integer \\
\hline
studies & Studiengang & string \\
\hline
passwd & encrypted password & string as from \texttt{crypt} \\
\hline
email & email address & string \\
\hline
wishlist & ids of other people & string \\
\hline
persondata1 & personal data number 1 & string \\
\hline
\vdots & \vdots & \vdots \\
\hline
persondata9 & personal data number 9 & string \\
\hline
\end{tabular}
\end{center}

\section{\texttt{data/groups.txt}}
\label{sec:groups.txt}

The general comments about file formats at the beginning of this chapter
apply also to \texttt{data/groups.txt}. The delimiter character for this
file is a colon ``:''. 

Each line of the file corresponds to the group membership data of one
participant and contains the following data fields (in the third column
some comments about the data type are displayed):

\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Name of field & Description & Data type \\
\hline
\hline
id & Identification & string \\
\hline
nr & Number of group the person is in & non-negative integer \\
\hline
\end{tabular}
\end{center}


\section{\texttt{data/groupinfo.txt}}
\label{sec:groupinfo.txt}

Note that usually you will have to edit this file by hand at the beginning
of your course to set up the information about your tutoring groups. 
Therefore it is particularly important to document the format of this file.

The general comments about file formats at the beginning of this chapter
apply also to \texttt{data/groupinfo.txt}. The delimiter character for this
file is a colon ``:''. Remember to quote possible colons ``:'' by
``\verb!\d!'' for example in time values like ``17:30''!

Each line of the file corresponds to the group data of one
tutoring group and contains the following data fields (in the third column
some comments about the data type are displayed):

\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Name of field & Description & Data type \\
\hline
\hline
nr & Number of group & non-negative integer \\
\hline
passwd & Password for this group & string \\
\hline
tutor & Name of tutor & string \\
\hline
place & Place of group session & string \\
\hline
time & Time of group session (remember ``\verb!\d!'' for ``\verb!:!''!) 
     & string \\
\hline
email & Email address of tutor & string \\
\hline
groupinfo1 & Additional group info number 1 & string \\
\hline
\vdots & \vdots & \vdots \\
\hline
groupinfo9 & Additional group info number 9 & string \\
\hline
\end{tabular}
\end{center}

Note that in the case of this file the group number is the identifying
field such that if more than one line with the same group number appears,
only the latest counts.

\section{\texttt{data/exams.txt}}
\label{sec:exams.txt}

Note that after an exam you will have to supply the content of this
file from outside the {\OKUSON} system. Usually you will have to type in
the data from the external grading procedure of the exam. Therefore it
is particularly important to document the format of this file.

The general comments about file formats at the beginning of this chapter
apply also to \texttt{data/exams.txt}. The delimiter character for this
file is a colon ``:''. 

Each line of the file corresponds to the exam information of one
participant for one exam and contains the following data fields (in the
third column some comments about the data type are displayed):

\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Name of field & Description & Data type \\
\hline
\hline
id & Identification & string \\
\hline
examnr & Number of exam (zero based) & non-negative integer \\
\hline
totalscore & Total score of participant & non-negative integer \\
\hline
maxscore & Maximal score in this exam & non-negative integer \\
\hline
separatescore & A string to store scores from parts of the exam & string \\
\hline
\end{tabular}
\end{center}

The last field can be used for arbitrary purposes. Especially the automatic
grading facilities of course have access to this information. The second
last field is not used within the {\OKUSON} system as of this writing.

\section{\texttt{data/messages.txt}}
\label{sec:messages.txt}

The general comments about file formats at the beginning of this chapter
apply also to \texttt{data/messages.txt}. There is however one exception,
namely that all lines corresponding to a certain ID count, not only the
last. Messages are therefore never deleted but only ``revoked'': If
a message is repeated with a dollar sign ``\$'' prepended, it will no
longer be displayed on the result page of the participant. 

The delimiter character for this file is a colon ``:''.

Each line of the file corresponds to one personal message for one
participant and contains the following data fields (in the third column
some comments about the data type are displayed):

\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Name of field & Description & Data type \\
\hline
\hline
id & Identification & string \\
\hline
msg & Personal message & string \\
\hline
\end{tabular}
\end{center}


\section{\texttt{data/generalmessage.txt}}
\label{sec:generalmessage.txt}

The format of this file is an exception. Its content is put into the
result page instead of a \texttt{<GeneralMessages />} element in the
template for the result page. The content of this file is copied one to
one without any change. Therefore you have to put a valid XHTML~1.0 subtree
into this file using the standard ISO-8859-1 ASCII encoding.


\chapter{Internal Data Structures}
\label{ch:intdata}

\section{Overview and Introduction}

This chapter is written to be read along with the files \texttt{Data.py}
and \texttt{Exercises.py} of the {\OKUSON} server's source code.
Knowing the internal data structures of the {\OKUSON} server requires 
a certain knowledge of the Python language, which we will assume throughout
this chapter.

Having said this, we no longer have to explain certain things: For example,
the names and types of components of objects in a certain class can readily
be read off the well-documented source code. Also the behaviour and syntax
for the basic Python objects like strings, integers, floats, lists,
and dictionaries will not be explained here. Therefore we concentrate
on the general structure and on the questions like ``What is where in
the source code?''.

All data structures regarding people and tutoring groups are collected in
the server's \texttt{Data} module and reside therefore in the file
\texttt{server/Data.py}. In this file one also finds the implementation
of the reading process from files into the memory data structures.
This process will not be explained here, as it uses a very generic
tool from the \texttt{fmTools} library, which will be documented elsewhere.

All data structures regarding exercises and sheets are collected in the
\texttt{Exercises} module and reside therefore in the file
\texttt{server/Exercises.py}. In this file one also finds the
implementation of the reading and parsing process from files into the 
memory data structures. This process will also not be explained here, as it
basically boils down to using the XML parser \texttt{pyRXP} to get a
memory representation of the XML tree, which is then recursively translated
into the in-memory structures described here. Additionally, the file
\texttt{server/Exercises.py} contains methods for \texttt{Exercise} and
\texttt{Sheet} objects to offer services via the web.

For this chapter here, we will not describe the latter processes but only
document the data structures. The main idea of this chapter is to help
the user to write the automatic grading functions he has to supply, because
they need conventient read access to the internal data structures.

\section{Data of Participants}

The data structures for the personal data of participants are organized
as follows: Every participant has an ID, which can be an arbitrary string.
There is a dictionary ``\texttt{people}'' in the \texttt{Data} module,
which stores for any known participant under his ID one object from the
class \texttt{Person}.

Every \texttt{Person} object has an entry \texttt{mcresults}, which is a
dictionary where under each sheet name (see section \ref{dataex}) there
can be stored an object from the class \texttt{MCResult}. Note that it
is not an inconsistency, if there is nothing bound in \texttt{mcresults}
under a valid sheet name! Therefore one always has to check whether there
is some data before accessing it!

Further, every \texttt{Person} object has an entry \texttt{homework},
which is a dictionary where for each sheet name (see section
\ref{dataex}) there can be stored an object from the class
\texttt{Homework}. Note that also here it is not an inconsistency, if
there is nothing bound in \texttt{homework} for a valid sheet name!

Every \texttt{Person} object has an entry \texttt{exams}, which is a list.
This list has a certain length and at each position (zero based!) there may
either be the value \texttt{None} or an object from the class
\texttt{Exam}. Note that lists in Python must not have holes, such that
it is necessary to have the possibility of the value \texttt{None}. Also
the length of the list is variable, therefore one cannot be sure that
it always has the same length for all participants, so please check in
your code! 

Note that the object of type \texttt{Exam} is created at the
time the participant registers for the first time for the exam in question
and is never destroyed afterwards. Even if the participant deregisters,
this only means that the \texttt{registration} component of the
\texttt{Exam} object is set to zero. A \texttt{totalscore} of $-1$
indicates, that the participant did not (yet) participate in the exam.

The personal messages of a person are just stored as a list of strings
in the \texttt{messages} component of the \texttt{Person} object. Revoked
messages are no longer stored in memory.


\section{Data of Groups}

The identification of groups works via their number. There is a global
dictionary \texttt{groups} in the \texttt{Data} module, where for each
group there is stored an object from the class \texttt{GroupInfo} under
the (string) value of its number. Numbers are non-negative integers.

The group number $0$ plays a special r\^ole, because it is the group where
people show up automatically, if the administrator does not distribute them
explicitly. This can be handy, if there is only one group for a small
course. The component \texttt{people} of the \texttt{GroupsInfo} object
is updated automatically, when a person registers with the system for the
first time.


\section{Data of Exercises and Sheets}
\label{dataex}

All data for exercises and sheets is collected in the \texttt{Exercises}
module in the {\OKUSON} server and resides therefore in the file
\texttt{server/Exercises.py}.

There are the classes \texttt{Sheet}, \texttt{Exercise},
\texttt{Question}, and \texttt{TeXText}. A sheet consists of exercises,
an exercises of questions, and the ``innermost'' parts of the whole
system are simple strings and \TeX-texts, which are texts or formulae, which
are typed in {\TeX} input and can be rendered into a PDF file or as
image in a web page.

There is a global list \texttt{AllSheets} where all known sheet
objects are stored in some random order. One should not access this list
directly, but use instead the function \texttt{SheetList} in the same
module, which returns a properly sorted list of triples, where each triple
corresponds to one sheet and consists of the sheet number, the sheet name,
and the sheet object itself.

The basic incredients of a sheet are stored in the \texttt{list} component,
which is a list containing \texttt{TeXText}s for the texts between
exercises and for non-interactive exercises, and \texttt{Exercise} objects
for the multiple choice exercises.

All exercises (multiple choice and non-interactive ones) are stored under
their name in the global dictionary \texttt{AllExercises}. Usually one
will not have to access this variable, as one usually will access the
exercises via the sheets they are contained in.

The basic incredients of an interactive exercise are objects of type
\texttt{Question}, which in turn contain probably several variants
with possibly different correct solutions.

The fundamental method for the personalization of sheets is the method
\texttt{ChooserFunction} of the class \texttt{Sheet}. It uses a numerical
seed as seed for a pseudo random process and returns the choice of actual
variants the corresponding participant gets. Note that the submissions and
marks stored in the \texttt{Data} module only make sense together with this
information and the information about the available sheets.

%\chapter{Structure of the Program}
\appendix
\chapter{Customization Examples}
\section{Using IDs of Different Type}

In Aachen all students have an associated  unique 6-digit number 
(the \emph{Matrikelnummer}) which is used all over the place. 
Therefore, we use it for registrations and as ID's within an {\OKUSON}
server. 

If you want to use other types of IDs, do the following:

\begin{itemize}
\item Adjust the two entries \texttt{<IdCheckRegExp>} and
\texttt{<GuestIdRegExp>} in your configuration file \texttt{Config.xml}.
\item Adjust all places where the word \emph{Matrikelnummer} appears in
templates.  There is one such line in the \texttt{<PDFTemplate>} entry of
\texttt{Config.xml}. And there are quite a few files in \texttt{html/*.tpl}. 
Here, change the word \emph{Matrikelnummer} to something more appropriate
and maybe increase the values of the \texttt{size} and \texttt{maxlength} 
attributes of corresponding \texttt{input} elements.
\end{itemize}

That's it.

\section{A Course Without Non-Interactive Homework Exercises}

If you are not going to give non-interactive exercises which are not graded
automatically by {\OKUSON}, do the following:

\begin{itemize}
\item Just ignore all remarks about \emph{homework points} in this manual 
and in input forms. 
\item Adjust the \texttt{<Results>} tag in the template file
\texttt{html/results.tpl} to exclude the homework points.
\end{itemize}

\section{A Course Without Interactive Exercises}

We also use {\OKUSON} for courses without interactive exercises, just to
take advantage of the other utilities: registration, tutoring- and  exam-
management, HTML versions of exercise sheets, etc.

In this case some things should be done a bit differently: In PDF-versions
of the sheets the exercises should not be put into a table (and they should
not be regenerated for each request), participants
should not need to type a password for getting the exercise sheet, there
should not be ID's in templates which now look the same to all participants.

To achieve this, copy the files in \texttt{html} with a second extension
\texttt{.nointeractive} over the files of the same name but without this
extension before further customizing the web pages. 

Then start the {\OKUSON} server and register a user with a guest ID (the
allowed guest IDs are configured in entry \texttt{<GuestIdRegExp>} of 
the configuration file \texttt{Config.xml}). Use this guest ID as value in the
tag 

\hspace{5mm}\texttt{<input type="hidden" name="id" value="???" />}

which you find in the nointeractive version of \texttt{html/exquery.html}.

\section{Managing Additional Personal Registration Data}

In this section we give a few examples of using the special tags explained
in section~\ref{ssec:regelts}. The first shows the use of a free-form
string, the next three are about asking for additional information
concerning tutoring groups using radio buttons, check boxes or select
options, respectively.

\subsubsection*{Example: Birthplace}

There are universities which use the place of birth as part of the
identification of a person in course certificates. To get and store that
information you can use the \texttt{persondata1} field. In the template 
\texttt{html/registration.tpl} you could add a block:

\begin{verbatim}
    <tr>
      <td>Place of Birth:</td>
      <td> <input size="30" maxlength="30" name="persondata1" 
                  value="" /> </td>
    </tr>
\end{verbatim}

And in the template \texttt{html/regchange2.tpl} you could add the following
block, in which the value from the registration (or last change) is preset:

\begin{verbatim}
    <tr>
      <td>Place of Birth</td>
      <td> <PersonData1Field /> </td>
    </tr>
\end{verbatim}

\subsubsection*{Example: Group Choice with Radio Buttons}

Say, you have three times for tutoring groups, on Monday, Tuesday and
Wednesday. Here is a way to let the participant choose exactly one of these.

In \texttt{html/registration.tpl}:

\begin{verbatim}
    <tr>
      <td>Preferred Tutoring Group:</td>
      <td>
        <input type="radio" name="persondata1" 
               value="Mon" checked="checked" />Monday,
        <input type="radio" name="persondata1" 
               value="Tue" />Tuesday,
        <input type="radio" name="persondata1" 
               value="Wed" />Wednesday
      </td>
    </tr>
\end{verbatim}

To get an appropriate block in the \texttt{html/regchange2.tpl} page with
the stored choice preselected use:

\begin{verbatim}
    <tr>
      <td>Preferred Tutoring Group:</td>
      <td>
         <PersonDataRadioButton name="persondata1" 
                                value="Mon" />Monday,
         <PersonDataRadioButton name="persondata1" 
                                value="Tue" />Tuesday,
         <PersonDataRadioButton name="persondata1" 
                                value="Wed" />Wednesday
      </td>
    </tr>
\end{verbatim}

\subsubsection*{Example: Group Choice with Select Options}

An alternative for the last example is to use the \texttt{select} element,
in particular if there are much more than three choices.

You could use the following in \texttt{html/registration.tpl}:

\begin{verbatim}
    <tr>
      <td>Preferred Tutoring Group:</td>
      <td> <select name="persondata1">
        <option value="Mon" selected="selected">Monday</option>
        <option value="Tue">Tuesday</option>
        <option value="Wed">Wednesday</option>
           </select>
      </td>
    </tr>
\end{verbatim}

Getting this with the stored value pre-selected in
\texttt{html/regchange2.tpl} you could use:

\begin{verbatim}
    <tr>
      <td>Preferred Tutoring Group:</td>
      <td> <select name="persondata1">
       <PersonDataSelectOption name="persondata1" value="Mon" 
                               content="Monday" />
       <PersonDataSelectOption name="persondata1" value="Tue" 
                               content="Tuesday" />
       <PersonDataSelectOption name="persondata1" value="Wed" 
                               content="Wednesday" />
       </select>
      </td>
    </tr>
\end{verbatim}

\subsubsection*{Example: Group Choice with Check Boxes}

As a third variant of the previous two examples, assume you want to allow
several choices by each participant. This could be done with check box input
elements. In this case you can store each choice independently in the
variables \texttt{persondata1} to \texttt{persondata3}. 

In \texttt{html/registration.tpl} you could add:

\begin{verbatim}
    <tr>
      <td>Possible Tutoring Groups:</td>
      <td>
        <input type="checkbox" name="persondata1" 
               value="yes" />Monday,
        <input type="checkbox" name="persondata2" 
               value="yes" />Tuesday,
        <input type="checkbox" name="persondata3" 
               value="yes" />Wednesday
      </td>
    </tr>
\end{verbatim}

In this case you could get a similar part of the form 
in \texttt{html/regchange2.tpl} with the stored values checked by:

\begin{verbatim}
    <tr>
      <td>Possible Tutoring Groups:</td>
      <td>
        <PersonDataCheckBox name="persondata1" 
                            value="yes" />Monday,
        <PersonDataCheckBox name="persondata2" 
                            value="yes" />Tuesday,
        <PersonDataCheckBox name="persondata3" 
                            value="yes" />Wednesday
      </td>
    </tr>
\end{verbatim}


\section{Customizing the Look and Feel of the Web Pages}

The most obvious thing to play around with may be the setting of colors or a
background image.

You may try the effect of changing the following line in
\texttt{html/OKUSON.css}:

\begin{verbatim}
      background-color:#B0E0E6;
\end{verbatim}

to

\begin{verbatim}
      background-color:#FF0000;
      color:#00FF00;
\end{verbatim}

You can be sure that some people cannot read anything on  pages with 
this setting, so this demonstrates that you should be quite careful with
choosing sensible colors. 

Or you can add a background image with a setting like:

\begin{verbatim}
      background-color:#CCCCCC;
      background-image:
        url(http://www.math.rwth-aachen.de/~OKUSON/badback.gif);
\end{verbatim}

Of course, as you can see here: Only use background images which don't
disturb the legibility of the pages!

More subtle changes would affect  table layout, fonts, relative font
sizes and many more details. See the 
\href{http://www.w3c.org}{\texttt{http://www.w3c.org}} pages or some book on
CSS if you do not know how to do this. The W3C pages also have an online 
validation service  for CSS style sheets.

As a general rule: Use only basic CSS features which are reasonably well 
implemented in essentially all current browsers (some CSS settings may
shorten the list of successful browser tests, as given in
\texttt{html/techinfo.tpl}).

There are two CSS style sheet files in the {\OKUSON} sample pages, 
\texttt{OKUSON.css} and \texttt{OKUSONSheet.css}. You must be more careful
with changes to the latter one. In particular, the background of the table
with the exercise texts as images should be white or very bright for good
legibility.

If you want to add some icon or some standard information on all course 
web pages, you must edit all template files accordingly. You can use the 
customization entries \texttt{<User1>} to \texttt{<User9>} 
in the \texttt{Config.xml} file together with the tags \texttt{<User1/>} to
\texttt{<User9/>} in the  template \texttt{.tpl} files. You can include HTML
markup in the content of these elements, but note that you must use a
\texttt{CDATA} environment or escape the markup with entities in your 
\texttt{Config.xml} (see~\ref{ch:introXML}). 


\section{Using {\OKUSON} with Another Language}

As mentioned in the web page chapter~\ref{ch:webpages} the {\OKUSON} system
can be adjusted to another language by translating the visible texts in all
sample web pages (the \texttt{html.sample/\ldots tpl} files). 

If you intend to do this, please contact us. Of course, we would be happy to
distribute {\OKUSON} with sets of sample pages in several languages.


\chapter{Differences Between XHTML and Other Variants of
HTML}\label{ch:diffHTMLXHTML}

If you know some HTML and compare it with the basics on XML as explained
in~\ref{ch:introXML} you see that the syntax rules for XHTML must be more
restrictive than for other (non-XML) variants of HTML. In particular note
the following details of XHTML:

\begin{itemize}
\item All tags must be written with lower case letters in the element names.
\item All non-empty elements must have a start- and end-tag, in particular
enclose paragraphs in \texttt{<p>} and \texttt{</p>} or list entries in
\texttt{<li>} and \texttt{</li>}.
\item Attributes always must have an assigned value and the value must be
enclosed by either double or single quotes.
\item Write empty elements like \texttt{<br />}, the space before the
\texttt{/>} is not necessary according to the specification but it helps
some old browsers to interpret it correctly.
\item Do not put information on colors or fonts in the XHTML file. Instead
use the \texttt{.css} style sheet file. (For complicated cases use the
\texttt{class} attribute to mark elements for which you want to give special
formating rules in the style sheet.
\end{itemize}

Using the W3C \href{http://www.w3.org/TR/html401/}{HTML~4.01 specification
(\texttt{http://www.w3.org/TR/html401/})} -- this includes a nice
\emph{elements} overview -- together with the above rules and the general rule
to avoid complicated looking constructs when possible, we found it not too
difficult to produce sets of valid web pages.

In the {\OKUSON} home directory you find the tool \texttt{xmlvalidate},
which can be used for validating (or finding problems with) XHTML documents.
But actually, all of our {\OKUSON} web pages are generated dynamically from
\texttt{.tpl} template  files, which cannot be validated directly.  Therefore,
we have included an on-the-fly XHTML-validation of HTML pages in the
{\OKUSON} built-in web server. It does not refuse the delivery of non-valid
pages, but removes in that case the validator icon which may have been 
put in the document via the \texttt{<ValidatorIcon/>} tag.




\chapter{GPL}\label{ch:GPL}

Here is the text of the license under which the {\OKUSON} package is
distributed. Instead of this you may also take any newer version as
published in {\texttt http://www.gnu.org/licenses/gpl.html}.


{ \scriptsize
\begin{center}
{\parindent 0in

Version 2, June 1991

Copyright \copyright\ 1989, 1991 Free Software Foundation, Inc.

\bigskip

59 Temple Place - Suite 330, Boston, MA  02111-1307, USA

\bigskip

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
}
\end{center}

\begin{center}
{\bf\large Preamble}
\end{center}


The licenses for most software are designed to take away your freedom to
share and change it.  By contrast, the GNU General Public License is
intended to guarantee your freedom to share and change free software---to
make sure the software is free for all its users.  This General Public
License applies to most of the Free Software Foundation's software and to
any other program whose authors commit to using it.  (Some other Free
Software Foundation software is covered by the GNU Library General Public
License instead.)  You can apply it to your programs, too.

When we speak of free software, we are referring to freedom, not price.
Our General Public Licenses are designed to make sure that you have the
freedom to distribute copies of free software (and charge for this service
if you wish), that you receive source code or can get it if you want it,
that you can change the software or use pieces of it in new free programs;
and that you know you can do these things.

To protect your rights, we need to make restrictions that forbid anyone to
deny you these rights or to ask you to surrender the rights.  These
restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

For example, if you distribute copies of such a program, whether gratis or
for a fee, you must give the recipients all the rights that you have.  You
must make sure that they, too, receive or can get the source code.  And
you must show them these terms so they know their rights.

We protect your rights with two steps: (1) copyright the software, and (2)
offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

Also, for each author's protection and ours, we want to make certain that
everyone understands that there is no warranty for this free software.  If
the software is modified by someone else and passed on, we want its
recipients to know that what they have is not the original, so that any
problems introduced by others will not reflect on the original authors'
reputations.

Finally, any free program is threatened constantly by software patents.
We wish to avoid the danger that redistributors of a free program will
individually obtain patent licenses, in effect making the program
proprietary.  To prevent this, we have made it clear that any patent must
be licensed for everyone's free use or not licensed at all.

The precise terms and conditions for copying, distribution and
modification follow.

\begin{center}
{\Large \sc Terms and Conditions For Copying, Distribution and
  Modification}
\end{center}


%\renewcommand{\theenumi}{\alpha{enumi}}
\begin{enumerate}

\addtocounter{enumi}{-1}

\item 

This License applies to any program or other work which contains a notice
placed by the copyright holder saying it may be distributed under the
terms of this General Public License.  The ``Program'', below, refers to
any such program or work, and a ``work based on the Program'' means either
the Program or any derivative work under copyright law: that is to say, a
work containing the Program or a portion of it, either verbatim or with
modifications and/or translated into another language.  (Hereinafter,
translation is included without limitation in the term ``modification''.)
Each licensee is addressed as ``you''.

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

\item You may copy and distribute verbatim copies of the Program's source
  code as you receive it, in any medium, provided that you conspicuously
  and appropriately publish on each copy an appropriate copyright notice
  and disclaimer of warranty; keep intact all the notices that refer to
  this License and to the absence of any warranty; and give any other
  recipients of the Program a copy of this License along with the Program.

You may charge a fee for the physical act of transferring a copy, and you
may at your option offer warranty protection in exchange for a fee.

\item

You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:

\begin{enumerate}

\item 

You must cause the modified files to carry prominent notices stating that
you changed the files and the date of any change.

\item

You must cause any work that you distribute or publish, that in
whole or in part contains or is derived from the Program or any
part thereof, to be licensed as a whole at no charge to all third
parties under the terms of this License.

\item
If the modified program normally reads commands interactively
when run, you must cause it, when started running for such
interactive use in the most ordinary way, to print or display an
announcement including an appropriate copyright notice and a
notice that there is no warranty (or else, saying that you provide
a warranty) and that users may redistribute the program under
these conditions, and telling the user how to view a copy of this
License.  (Exception: if the Program itself is interactive but
does not normally print such an announcement, your work based on
the Program is not required to print an announcement.)

\end{enumerate}


These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

\item
You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:

\begin{enumerate}

\item

Accompany it with the complete corresponding machine-readable
source code, which must be distributed under the terms of Sections
1 and 2 above on a medium customarily used for software interchange; or,

\item

Accompany it with a written offer, valid for at least three
years, to give any third party, for a charge no more than your
cost of physically performing source distribution, a complete
machine-readable copy of the corresponding source code, to be
distributed under the terms of Sections 1 and 2 above on a medium
customarily used for software interchange; or,

\item

Accompany it with the information you received as to the offer
to distribute corresponding source code.  (This alternative is
allowed only for noncommercial distribution and only if you
received the program in object code or executable form with such
an offer, in accord with Subsection b above.)

\end{enumerate}


The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

\item
You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

\item
You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

\item
Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

\item
If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

\item
If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

\item
The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and ``any
later version'', you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

\item
If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.

\begin{center}
{\Large\sc
No Warranty
}
\end{center}

\item
{\sc Because the program is licensed free of charge, there is no warranty
for the program, to the extent permitted by applicable law.  Except when
otherwise stated in writing the copyright holders and/or other parties
provide the program ``as is'' without warranty of any kind, either expressed
or implied, including, but not limited to, the implied warranties of
merchantability and fitness for a particular purpose.  The entire risk as
to the quality and performance of the program is with you.  Should the
program prove defective, you assume the cost of all necessary servicing,
repair or correction.}

\item
{\sc In no event unless required by applicable law or agreed to in writing
will any copyright holder, or any other party who may modify and/or
redistribute the program as permitted above, be liable to you for damages,
including any general, special, incidental or consequential damages arising
out of the use or inability to use the program (including but not limited
to loss of data or data being rendered inaccurate or losses sustained by
you or third parties or a failure of the program to operate with any other
programs), even if such holder or other party has been advised of the
possibility of such damages.}

\end{enumerate}
}


\end{document}
